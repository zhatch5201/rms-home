{"ast":null,"code":"\"use strict\"; // Copyright 2015 Google LLC\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nvar _slicedToArray = require(\"C:/Users/Zack/Desktop/rms-home/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/slicedToArray\");\n\nvar _classCallCheck = require(\"C:/Users/Zack/Desktop/rms-home/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"C:/Users/Zack/Desktop/rms-home/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _inherits = require(\"C:/Users/Zack/Desktop/rms-home/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/inherits\");\n\nvar _createSuper = require(\"C:/Users/Zack/Desktop/rms-home/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createSuper\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/*!\n * @module common/service-object\n */\n\nvar promisify_1 = require(\"@google-cloud/promisify\");\n\nvar arrify = require(\"arrify\");\n\nvar events_1 = require(\"events\");\n\nvar extend = require(\"extend\");\n\nvar util_1 = require(\"./util\");\n/**\n * ServiceObject is a base class, meant to be inherited from by a \"service\n * object,\" like a BigQuery dataset or Storage bucket.\n *\n * Most of the time, these objects share common functionality; they can be\n * created or deleted, and you can get or set their metadata.\n *\n * By inheriting from this class, a service object will be extended with these\n * shared behaviors. Note that any method can be overridden when the service\n * object requires specific behavior.\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\nvar ServiceObject = /*#__PURE__*/function (_events_1$EventEmitte) {\n  _inherits(ServiceObject, _events_1$EventEmitte);\n\n  var _super = _createSuper(ServiceObject);\n\n  /*\n   * @constructor\n   * @alias module:common/service-object\n   *\n   * @private\n   *\n   * @param {object} config - Configuration object.\n   * @param {string} config.baseUrl - The base URL to make API requests to.\n   * @param {string} config.createMethod - The method which creates this object.\n   * @param {string=} config.id - The identifier of the object. For example, the\n   *     name of a Storage bucket or Pub/Sub topic.\n   * @param {object=} config.methods - A map of each method name that should be inherited.\n   * @param {object} config.methods[].reqOpts - Default request options for this\n   *     particular method. A common use case is when `setMetadata` requires a\n   *     `PUT` method to override the default `PATCH`.\n   * @param {object} config.parent - The parent service instance. For example, an\n   *     instance of Storage if the object is Bucket.\n   */\n  function ServiceObject(config) {\n    var _this;\n\n    _classCallCheck(this, ServiceObject);\n\n    _this = _super.call(this);\n    _this.metadata = {};\n    _this.baseUrl = config.baseUrl;\n    _this.parent = config.parent; // Parent class.\n\n    _this.id = config.id; // Name or ID (e.g. dataset ID, bucket name, etc).\n\n    _this.createMethod = config.createMethod;\n    _this.methods = config.methods || {};\n    _this.interceptors = [];\n    _this.pollIntervalMs = config.pollIntervalMs;\n\n    if (config.methods) {\n      // This filters the ServiceObject instance (e.g. a \"File\") to only have\n      // the configured methods. We make a couple of exceptions for core-\n      // functionality (\"request()\" and \"getRequestInterceptors()\")\n      Object.getOwnPropertyNames(ServiceObject.prototype).filter(function (methodName) {\n        return (// All ServiceObjects need `request` and `getRequestInterceptors`.\n          // clang-format off\n          !/^request/.test(methodName) && !/^getRequestInterceptors/.test(methodName) && // clang-format on\n          // The ServiceObject didn't redefine the method.\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          _this[methodName] === // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          ServiceObject.prototype[methodName] && // This method isn't wanted.\n          !config.methods[methodName]\n        );\n      }).forEach(function (methodName) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        _this[methodName] = undefined;\n      });\n    }\n\n    return _this;\n  }\n\n  _createClass(ServiceObject, [{\n    key: \"create\",\n    value: function create(optionsOrCallback, callback) {\n      // eslint-disable-next-line @typescript-eslint/no-this-alias\n      var self = this;\n      var args = [this.id];\n\n      if (typeof optionsOrCallback === 'function') {\n        callback = optionsOrCallback;\n      }\n\n      if (typeof optionsOrCallback === 'object') {\n        args.push(optionsOrCallback);\n      } // Wrap the callback to return *this* instance of the object, not the\n      // newly-created one.\n      // tslint: disable-next-line no-any\n\n\n      function onCreate() {\n        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n          args[_key] = arguments[_key];\n        }\n\n        var err = args[0],\n            instance = args[1];\n\n        if (!err) {\n          self.metadata = instance.metadata;\n          args[1] = self; // replace the created `instance` with this one.\n        }\n\n        callback.apply(void 0, args);\n      }\n\n      args.push(onCreate); // eslint-disable-next-line prefer-spread\n\n      this.createMethod.apply(null, args);\n    }\n  }, {\n    key: \"delete\",\n    value: function _delete(optionsOrCallback, cb) {\n      var _util_1$util$maybeOpt = util_1.util.maybeOptionsOrCallback(optionsOrCallback, cb),\n          _util_1$util$maybeOpt2 = _slicedToArray(_util_1$util$maybeOpt, 2),\n          options = _util_1$util$maybeOpt2[0],\n          callback = _util_1$util$maybeOpt2[1];\n\n      var ignoreNotFound = options.ignoreNotFound;\n      delete options.ignoreNotFound;\n      var methodConfig = typeof this.methods.delete === 'object' && this.methods.delete || {};\n      var reqOpts = extend(true, {\n        method: 'DELETE',\n        uri: ''\n      }, methodConfig.reqOpts, {\n        qs: options\n      }); // The `request` method may have been overridden to hold any special\n      // behavior. Ensure we call the original `request` method.\n\n      ServiceObject.prototype.request.call(this, reqOpts, function (err) {\n        if (err) {\n          if (err.code === 404 && ignoreNotFound) {\n            err = null;\n          }\n        }\n\n        for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n          args[_key2 - 1] = arguments[_key2];\n        }\n\n        callback.apply(void 0, [err].concat(args));\n      });\n    }\n  }, {\n    key: \"exists\",\n    value: function exists(optionsOrCallback, cb) {\n      var _util_1$util$maybeOpt3 = util_1.util.maybeOptionsOrCallback(optionsOrCallback, cb),\n          _util_1$util$maybeOpt4 = _slicedToArray(_util_1$util$maybeOpt3, 2),\n          options = _util_1$util$maybeOpt4[0],\n          callback = _util_1$util$maybeOpt4[1];\n\n      this.get(options, function (err) {\n        if (err) {\n          if (err.code === 404) {\n            callback(null, false);\n          } else {\n            callback(err);\n          }\n\n          return;\n        }\n\n        callback(null, true);\n      });\n    }\n  }, {\n    key: \"get\",\n    value: function get(optionsOrCallback, cb) {\n      // eslint-disable-next-line @typescript-eslint/no-this-alias\n      var self = this;\n\n      var _util_1$util$maybeOpt5 = util_1.util.maybeOptionsOrCallback(optionsOrCallback, cb),\n          _util_1$util$maybeOpt6 = _slicedToArray(_util_1$util$maybeOpt5, 2),\n          opts = _util_1$util$maybeOpt6[0],\n          callback = _util_1$util$maybeOpt6[1];\n\n      var options = Object.assign({}, opts);\n      var autoCreate = options.autoCreate && typeof this.create === 'function';\n      delete options.autoCreate;\n\n      function onCreate(err, instance, apiResponse) {\n        if (err) {\n          if (err.code === 409) {\n            self.get(options, callback);\n            return;\n          }\n\n          callback(err, null, apiResponse);\n          return;\n        }\n\n        callback(null, instance, apiResponse);\n      }\n\n      this.getMetadata(options, function (err, metadata) {\n        if (err) {\n          if (err.code === 404 && autoCreate) {\n            var args = [];\n\n            if (Object.keys(options).length > 0) {\n              args.push(options);\n            }\n\n            args.push(onCreate);\n            self.create.apply(self, args);\n            return;\n          }\n\n          callback(err, null, metadata);\n          return;\n        }\n\n        callback(null, self, metadata);\n      });\n    }\n  }, {\n    key: \"getMetadata\",\n    value: function getMetadata(optionsOrCallback, cb) {\n      var _this2 = this;\n\n      var _util_1$util$maybeOpt7 = util_1.util.maybeOptionsOrCallback(optionsOrCallback, cb),\n          _util_1$util$maybeOpt8 = _slicedToArray(_util_1$util$maybeOpt7, 2),\n          options = _util_1$util$maybeOpt8[0],\n          callback = _util_1$util$maybeOpt8[1];\n\n      var methodConfig = typeof this.methods.getMetadata === 'object' && this.methods.getMetadata || {};\n      var reqOpts = extend(true, {\n        uri: ''\n      }, methodConfig.reqOpts, {\n        qs: options\n      }); // The `request` method may have been overridden to hold any special\n      // behavior. Ensure we call the original `request` method.\n\n      ServiceObject.prototype.request.call(this, reqOpts, function (err, body, res) {\n        _this2.metadata = body;\n        callback(err, _this2.metadata, res);\n      });\n    }\n    /**\n     * Return the user's custom request interceptors.\n     */\n\n  }, {\n    key: \"getRequestInterceptors\",\n    value: function getRequestInterceptors() {\n      // Interceptors should be returned in the order they were assigned.\n      var localInterceptors = this.interceptors.filter(function (interceptor) {\n        return typeof interceptor.request === 'function';\n      }).map(function (interceptor) {\n        return interceptor.request;\n      });\n      return this.parent.getRequestInterceptors().concat(localInterceptors);\n    }\n  }, {\n    key: \"setMetadata\",\n    value: function setMetadata(metadata, optionsOrCallback, cb) {\n      var _this3 = this;\n\n      var _util_1$util$maybeOpt9 = util_1.util.maybeOptionsOrCallback(optionsOrCallback, cb),\n          _util_1$util$maybeOpt10 = _slicedToArray(_util_1$util$maybeOpt9, 2),\n          options = _util_1$util$maybeOpt10[0],\n          callback = _util_1$util$maybeOpt10[1];\n\n      var methodConfig = typeof this.methods.setMetadata === 'object' && this.methods.setMetadata || {};\n      var reqOpts = extend(true, {}, {\n        method: 'PATCH',\n        uri: ''\n      }, methodConfig.reqOpts, {\n        json: metadata,\n        qs: options\n      }); // The `request` method may have been overridden to hold any special\n      // behavior. Ensure we call the original `request` method.\n\n      ServiceObject.prototype.request.call(this, reqOpts, function (err, body, res) {\n        _this3.metadata = body;\n        callback(err, _this3.metadata, res);\n      });\n    }\n  }, {\n    key: \"request_\",\n    value: function request_(reqOpts, callback) {\n      reqOpts = extend(true, {}, reqOpts);\n      var isAbsoluteUrl = reqOpts.uri.indexOf('http') === 0;\n      var uriComponents = [this.baseUrl, this.id || '', reqOpts.uri];\n\n      if (isAbsoluteUrl) {\n        uriComponents.splice(0, uriComponents.indexOf(reqOpts.uri));\n      }\n\n      reqOpts.uri = uriComponents.filter(function (x) {\n        return x.trim();\n      }) // Limit to non-empty strings.\n      .map(function (uriComponent) {\n        var trimSlashesRegex = /^\\/*|\\/*$/g;\n        return uriComponent.replace(trimSlashesRegex, '');\n      }).join('/');\n      var childInterceptors = arrify(reqOpts.interceptors_);\n      var localInterceptors = [].slice.call(this.interceptors);\n      reqOpts.interceptors_ = childInterceptors.concat(localInterceptors);\n\n      if (reqOpts.shouldReturnStream) {\n        return this.parent.requestStream(reqOpts);\n      }\n\n      this.parent.request(reqOpts, callback);\n    }\n  }, {\n    key: \"request\",\n    value: function request(reqOpts, callback) {\n      this.request_(reqOpts, callback);\n    }\n    /**\n     * Make an authenticated API request.\n     *\n     * @param {object} reqOpts - Request options that are passed to `request`.\n     * @param {string} reqOpts.uri - A URI relative to the baseUrl.\n     */\n\n  }, {\n    key: \"requestStream\",\n    value: function requestStream(reqOpts) {\n      var opts = extend(true, reqOpts, {\n        shouldReturnStream: true\n      });\n      return this.request_(opts);\n    }\n  }]);\n\n  return ServiceObject;\n}(events_1.EventEmitter);\n\nexports.ServiceObject = ServiceObject;\npromisify_1.promisifyAll(ServiceObject, {\n  exclude: ['getRequestInterceptors']\n});","map":{"version":3,"sources":["C:/Users/Zack/Desktop/rms-home/node_modules/@google-cloud/common/build/src/service-object.js"],"names":["Object","defineProperty","exports","value","promisify_1","require","arrify","events_1","extend","util_1","ServiceObject","config","metadata","baseUrl","parent","id","createMethod","methods","interceptors","pollIntervalMs","getOwnPropertyNames","prototype","filter","methodName","test","forEach","undefined","optionsOrCallback","callback","self","args","push","onCreate","err","instance","apply","cb","util","maybeOptionsOrCallback","options","ignoreNotFound","methodConfig","delete","reqOpts","method","uri","qs","request","call","code","get","opts","assign","autoCreate","create","apiResponse","getMetadata","keys","length","body","res","localInterceptors","interceptor","map","getRequestInterceptors","concat","setMetadata","json","isAbsoluteUrl","indexOf","uriComponents","splice","x","trim","uriComponent","trimSlashesRegex","replace","join","childInterceptors","interceptors_","slice","shouldReturnStream","requestStream","request_","EventEmitter","promisifyAll","exclude"],"mappings":"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","sourcesContent":["\"use strict\";\n// Copyright 2015 Google LLC\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/*!\n * @module common/service-object\n */\nconst promisify_1 = require(\"@google-cloud/promisify\");\nconst arrify = require(\"arrify\");\nconst events_1 = require(\"events\");\nconst extend = require(\"extend\");\nconst util_1 = require(\"./util\");\n/**\n * ServiceObject is a base class, meant to be inherited from by a \"service\n * object,\" like a BigQuery dataset or Storage bucket.\n *\n * Most of the time, these objects share common functionality; they can be\n * created or deleted, and you can get or set their metadata.\n *\n * By inheriting from this class, a service object will be extended with these\n * shared behaviors. Note that any method can be overridden when the service\n * object requires specific behavior.\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nclass ServiceObject extends events_1.EventEmitter {\n    /*\n     * @constructor\n     * @alias module:common/service-object\n     *\n     * @private\n     *\n     * @param {object} config - Configuration object.\n     * @param {string} config.baseUrl - The base URL to make API requests to.\n     * @param {string} config.createMethod - The method which creates this object.\n     * @param {string=} config.id - The identifier of the object. For example, the\n     *     name of a Storage bucket or Pub/Sub topic.\n     * @param {object=} config.methods - A map of each method name that should be inherited.\n     * @param {object} config.methods[].reqOpts - Default request options for this\n     *     particular method. A common use case is when `setMetadata` requires a\n     *     `PUT` method to override the default `PATCH`.\n     * @param {object} config.parent - The parent service instance. For example, an\n     *     instance of Storage if the object is Bucket.\n     */\n    constructor(config) {\n        super();\n        this.metadata = {};\n        this.baseUrl = config.baseUrl;\n        this.parent = config.parent; // Parent class.\n        this.id = config.id; // Name or ID (e.g. dataset ID, bucket name, etc).\n        this.createMethod = config.createMethod;\n        this.methods = config.methods || {};\n        this.interceptors = [];\n        this.pollIntervalMs = config.pollIntervalMs;\n        if (config.methods) {\n            // This filters the ServiceObject instance (e.g. a \"File\") to only have\n            // the configured methods. We make a couple of exceptions for core-\n            // functionality (\"request()\" and \"getRequestInterceptors()\")\n            Object.getOwnPropertyNames(ServiceObject.prototype)\n                .filter(methodName => {\n                return (\n                // All ServiceObjects need `request` and `getRequestInterceptors`.\n                // clang-format off\n                !/^request/.test(methodName) &&\n                    !/^getRequestInterceptors/.test(methodName) &&\n                    // clang-format on\n                    // The ServiceObject didn't redefine the method.\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    this[methodName] ===\n                        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                        ServiceObject.prototype[methodName] &&\n                    // This method isn't wanted.\n                    !config.methods[methodName]);\n            })\n                .forEach(methodName => {\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                this[methodName] = undefined;\n            });\n        }\n    }\n    create(optionsOrCallback, callback) {\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        const self = this;\n        const args = [this.id];\n        if (typeof optionsOrCallback === 'function') {\n            callback = optionsOrCallback;\n        }\n        if (typeof optionsOrCallback === 'object') {\n            args.push(optionsOrCallback);\n        }\n        // Wrap the callback to return *this* instance of the object, not the\n        // newly-created one.\n        // tslint: disable-next-line no-any\n        function onCreate(...args) {\n            const [err, instance] = args;\n            if (!err) {\n                self.metadata = instance.metadata;\n                args[1] = self; // replace the created `instance` with this one.\n            }\n            callback(...args);\n        }\n        args.push(onCreate);\n        // eslint-disable-next-line prefer-spread\n        this.createMethod.apply(null, args);\n    }\n    delete(optionsOrCallback, cb) {\n        const [options, callback] = util_1.util.maybeOptionsOrCallback(optionsOrCallback, cb);\n        const ignoreNotFound = options.ignoreNotFound;\n        delete options.ignoreNotFound;\n        const methodConfig = (typeof this.methods.delete === 'object' && this.methods.delete) || {};\n        const reqOpts = extend(true, {\n            method: 'DELETE',\n            uri: '',\n        }, methodConfig.reqOpts, {\n            qs: options,\n        });\n        // The `request` method may have been overridden to hold any special\n        // behavior. Ensure we call the original `request` method.\n        ServiceObject.prototype.request.call(this, reqOpts, (err, ...args) => {\n            if (err) {\n                if (err.code === 404 && ignoreNotFound) {\n                    err = null;\n                }\n            }\n            callback(err, ...args);\n        });\n    }\n    exists(optionsOrCallback, cb) {\n        const [options, callback] = util_1.util.maybeOptionsOrCallback(optionsOrCallback, cb);\n        this.get(options, err => {\n            if (err) {\n                if (err.code === 404) {\n                    callback(null, false);\n                }\n                else {\n                    callback(err);\n                }\n                return;\n            }\n            callback(null, true);\n        });\n    }\n    get(optionsOrCallback, cb) {\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        const self = this;\n        const [opts, callback] = util_1.util.maybeOptionsOrCallback(optionsOrCallback, cb);\n        const options = Object.assign({}, opts);\n        const autoCreate = options.autoCreate && typeof this.create === 'function';\n        delete options.autoCreate;\n        function onCreate(err, instance, apiResponse) {\n            if (err) {\n                if (err.code === 409) {\n                    self.get(options, callback);\n                    return;\n                }\n                callback(err, null, apiResponse);\n                return;\n            }\n            callback(null, instance, apiResponse);\n        }\n        this.getMetadata(options, (err, metadata) => {\n            if (err) {\n                if (err.code === 404 && autoCreate) {\n                    const args = [];\n                    if (Object.keys(options).length > 0) {\n                        args.push(options);\n                    }\n                    args.push(onCreate);\n                    self.create(...args);\n                    return;\n                }\n                callback(err, null, metadata);\n                return;\n            }\n            callback(null, self, metadata);\n        });\n    }\n    getMetadata(optionsOrCallback, cb) {\n        const [options, callback] = util_1.util.maybeOptionsOrCallback(optionsOrCallback, cb);\n        const methodConfig = (typeof this.methods.getMetadata === 'object' &&\n            this.methods.getMetadata) ||\n            {};\n        const reqOpts = extend(true, {\n            uri: '',\n        }, methodConfig.reqOpts, {\n            qs: options,\n        });\n        // The `request` method may have been overridden to hold any special\n        // behavior. Ensure we call the original `request` method.\n        ServiceObject.prototype.request.call(this, reqOpts, (err, body, res) => {\n            this.metadata = body;\n            callback(err, this.metadata, res);\n        });\n    }\n    /**\n     * Return the user's custom request interceptors.\n     */\n    getRequestInterceptors() {\n        // Interceptors should be returned in the order they were assigned.\n        const localInterceptors = this.interceptors\n            .filter(interceptor => typeof interceptor.request === 'function')\n            .map(interceptor => interceptor.request);\n        return this.parent.getRequestInterceptors().concat(localInterceptors);\n    }\n    setMetadata(metadata, optionsOrCallback, cb) {\n        const [options, callback] = util_1.util.maybeOptionsOrCallback(optionsOrCallback, cb);\n        const methodConfig = (typeof this.methods.setMetadata === 'object' &&\n            this.methods.setMetadata) ||\n            {};\n        const reqOpts = extend(true, {}, {\n            method: 'PATCH',\n            uri: '',\n        }, methodConfig.reqOpts, {\n            json: metadata,\n            qs: options,\n        });\n        // The `request` method may have been overridden to hold any special\n        // behavior. Ensure we call the original `request` method.\n        ServiceObject.prototype.request.call(this, reqOpts, (err, body, res) => {\n            this.metadata = body;\n            callback(err, this.metadata, res);\n        });\n    }\n    request_(reqOpts, callback) {\n        reqOpts = extend(true, {}, reqOpts);\n        const isAbsoluteUrl = reqOpts.uri.indexOf('http') === 0;\n        const uriComponents = [this.baseUrl, this.id || '', reqOpts.uri];\n        if (isAbsoluteUrl) {\n            uriComponents.splice(0, uriComponents.indexOf(reqOpts.uri));\n        }\n        reqOpts.uri = uriComponents\n            .filter(x => x.trim()) // Limit to non-empty strings.\n            .map(uriComponent => {\n            const trimSlashesRegex = /^\\/*|\\/*$/g;\n            return uriComponent.replace(trimSlashesRegex, '');\n        })\n            .join('/');\n        const childInterceptors = arrify(reqOpts.interceptors_);\n        const localInterceptors = [].slice.call(this.interceptors);\n        reqOpts.interceptors_ = childInterceptors.concat(localInterceptors);\n        if (reqOpts.shouldReturnStream) {\n            return this.parent.requestStream(reqOpts);\n        }\n        this.parent.request(reqOpts, callback);\n    }\n    request(reqOpts, callback) {\n        this.request_(reqOpts, callback);\n    }\n    /**\n     * Make an authenticated API request.\n     *\n     * @param {object} reqOpts - Request options that are passed to `request`.\n     * @param {string} reqOpts.uri - A URI relative to the baseUrl.\n     */\n    requestStream(reqOpts) {\n        const opts = extend(true, reqOpts, { shouldReturnStream: true });\n        return this.request_(opts);\n    }\n}\nexports.ServiceObject = ServiceObject;\npromisify_1.promisifyAll(ServiceObject, { exclude: ['getRequestInterceptors'] });\n//# sourceMappingURL=service-object.js.map"]},"metadata":{},"sourceType":"script"}