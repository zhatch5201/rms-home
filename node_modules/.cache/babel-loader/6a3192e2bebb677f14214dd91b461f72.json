{"ast":null,"code":"\"use strict\";\n/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nvar _inherits = require(\"C:/Users/Zack/Desktop/rms-home/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/inherits\");\n\nvar _createSuper = require(\"C:/Users/Zack/Desktop/rms-home/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createSuper\");\n\nvar _classCallCheck = require(\"C:/Users/Zack/Desktop/rms-home/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"C:/Users/Zack/Desktop/rms-home/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.OngoingCallPromise = exports.OngoingCall = void 0;\n\nvar status_1 = require(\"./status\");\n\nvar googleError_1 = require(\"./googleError\");\n\nvar OngoingCall = /*#__PURE__*/function () {\n  /**\n   * OngoingCall manages callback, API calls, and cancellation\n   * of the API calls.\n   * @param {APICallback=} callback\n   *   The callback to be called asynchronously when the API call\n   *   finishes.\n   * @constructor\n   * @property {APICallback} callback\n   *   The callback function to be called.\n   * @private\n   */\n  function OngoingCall(callback) {\n    _classCallCheck(this, OngoingCall);\n\n    this.callback = callback;\n    this.completed = false;\n  }\n  /**\n   * Cancels the ongoing promise.\n   */\n\n\n  _createClass(OngoingCall, [{\n    key: \"cancel\",\n    value: function cancel() {\n      if (this.completed) {\n        return;\n      }\n\n      this.completed = true;\n\n      if (this.cancelFunc) {\n        this.cancelFunc();\n      } else {\n        var error = new googleError_1.GoogleError('cancelled');\n        error.code = status_1.Status.CANCELLED;\n        this.callback(error);\n      }\n    }\n    /**\n     * Call calls the specified function. Result will be used to fulfill\n     * the promise.\n     *\n     * @param {SimpleCallbackFunction} func\n     *   A function for an API call.\n     * @param {Object} argument\n     *   A request object.\n     */\n\n  }, {\n    key: \"call\",\n    value: function call(func, argument) {\n      var _this = this;\n\n      if (this.completed) {\n        return;\n      } // eslint-disable-next-line\n\n\n      var canceller = func(argument, function () {\n        _this.completed = true;\n\n        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n          args[_key] = arguments[_key];\n        }\n\n        setImmediate.apply(void 0, [_this.callback].concat(args));\n      });\n\n      this.cancelFunc = function () {\n        return canceller.cancel();\n      };\n    }\n  }]);\n\n  return OngoingCall;\n}();\n\nexports.OngoingCall = OngoingCall;\n\nvar OngoingCallPromise = /*#__PURE__*/function (_OngoingCall) {\n  _inherits(OngoingCallPromise, _OngoingCall);\n\n  var _super = _createSuper(OngoingCallPromise);\n\n  /**\n   * GaxPromise is GRPCCallbackWrapper, but it holds a promise when\n   * the API call finishes.\n   * @constructor\n   * @private\n   */\n  function OngoingCallPromise() {\n    var _this2;\n\n    _classCallCheck(this, OngoingCallPromise);\n\n    var resolveCallback;\n    var rejectCallback;\n\n    var callback = function callback(err, response, next, rawResponse) {\n      if (err) {\n        rejectCallback(err);\n      } else if (response !== undefined) {\n        resolveCallback([response, next || null, rawResponse || null]);\n      } else {\n        throw new googleError_1.GoogleError('Neither error nor response are defined');\n      }\n    };\n\n    var promise = new Promise(function (resolve, reject) {\n      resolveCallback = resolve;\n      rejectCallback = reject;\n    });\n    _this2 = _super.call(this, callback);\n    _this2.promise = promise;\n\n    _this2.promise.cancel = function () {\n      _this2.cancel();\n    };\n\n    return _this2;\n  }\n\n  return OngoingCallPromise;\n}(OngoingCall);\n\nexports.OngoingCallPromise = OngoingCallPromise;","map":{"version":3,"sources":["../../src/call.ts"],"names":[],"mappings":";AAAA;;;;;;;;;;;;;;AAcG;;;;;;;;;;;;;;;AAEH,IAAA,QAAA,GAAA,OAAA,CAAA,UAAA,CAAA;;AAWA,IAAA,aAAA,GAAA,OAAA,CAAA,eAAA,CAAA;;IAEa,W;AAKX;;;;;;;;;;AAUG;AACH,uBAAY,QAAZ,EAAiC;AAAA;;AAC/B,SAAK,QAAL,GAAgB,QAAhB;AACA,SAAK,SAAL,GAAiB,KAAjB;AACD;AAED;;AAEG;;;;;WACH,kBAAM;AACJ,UAAI,KAAK,SAAT,EAAoB;AAClB;AACD;;AACD,WAAK,SAAL,GAAiB,IAAjB;;AACA,UAAI,KAAK,UAAT,EAAqB;AACnB,aAAK,UAAL;AACD,OAFD,MAEO;AACL,YAAM,KAAK,GAAG,IAAI,aAAA,CAAA,WAAJ,CAAgB,WAAhB,CAAd;AACA,QAAA,KAAK,CAAC,IAAN,GAAa,QAAA,CAAA,MAAA,CAAO,SAApB;AACA,aAAK,QAAL,CAAe,KAAf;AACD;AACF;AAED;;;;;;;;AAQG;;;;WACH,cAAK,IAAL,EAAmC,QAAnC,EAAwD;AAAA;;AACtD,UAAI,KAAK,SAAT,EAAoB;AAClB;AACD,OAHqD,CAItD;;;AACA,UAAM,SAAS,GAAG,IAAI,CAAC,QAAD,EAAW,YAAmB;AAClD,QAAA,KAAI,CAAC,SAAL,GAAiB,IAAjB;;AADkD,0CAAf,IAAe;AAAf,UAAA,IAAe;AAAA;;AAElD,QAAA,YAAY,MAAZ,UAAa,KAAI,CAAC,QAAlB,SAAgC,IAAhC;AACD,OAHqB,CAAtB;;AAIA,WAAK,UAAL,GAAkB;AAAA,eAAM,SAAS,CAAC,MAAV,EAAN;AAAA,OAAlB;AACD;;;;;;AAzDH,OAAA,CAAA,WAAA,GAAA,WAAA;;IAgEa,kB;;;;;AAEX;;;;;AAKG;AACH,gCAAA;AAAA;;AAAA;;AACE,QAAI,eAAJ;AAGA,QAAI,cAAJ;;AACA,QAAM,QAAQ,GAAgB,SAAxB,QAAwB,CAC5B,GAD4B,EAE5B,QAF4B,EAG5B,IAH4B,EAI5B,WAJ4B,EAK1B;AACF,UAAI,GAAJ,EAAS;AACP,QAAA,cAAc,CAAC,GAAD,CAAd;AACD,OAFD,MAEO,IAAI,QAAQ,KAAK,SAAjB,EAA4B;AACjC,QAAA,eAAe,CAAC,CAAC,QAAD,EAAW,IAAI,IAAI,IAAnB,EAAyB,WAAW,IAAI,IAAxC,CAAD,CAAf;AACD,OAFM,MAEA;AACL,cAAM,IAAI,aAAA,CAAA,WAAJ,CAAgB,wCAAhB,CAAN;AACD;AACF,KAbD;;AAcA,QAAM,OAAO,GAAG,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAU,MAAV,EAAoB;AAC9C,MAAA,eAAe,GAAG,OAAlB;AACA,MAAA,cAAc,GAAG,MAAjB;AACD,KAHe,CAAhB;AAIA,+BAAM,QAAN;AACA,WAAK,OAAL,GAAe,OAAf;;AACA,WAAK,OAAL,CAAa,MAAb,GAAsB,YAAK;AACzB,aAAK,MAAL;AACD,KAFD;;AAzBF;AA4BC;;;EApCqC,W;;AAAxC,OAAA,CAAA,kBAAA,GAAA,kBAAA","sourceRoot":"","sourcesContent":["\"use strict\";\n/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.OngoingCallPromise = exports.OngoingCall = void 0;\nconst status_1 = require(\"./status\");\nconst googleError_1 = require(\"./googleError\");\nclass OngoingCall {\n    /**\n     * OngoingCall manages callback, API calls, and cancellation\n     * of the API calls.\n     * @param {APICallback=} callback\n     *   The callback to be called asynchronously when the API call\n     *   finishes.\n     * @constructor\n     * @property {APICallback} callback\n     *   The callback function to be called.\n     * @private\n     */\n    constructor(callback) {\n        this.callback = callback;\n        this.completed = false;\n    }\n    /**\n     * Cancels the ongoing promise.\n     */\n    cancel() {\n        if (this.completed) {\n            return;\n        }\n        this.completed = true;\n        if (this.cancelFunc) {\n            this.cancelFunc();\n        }\n        else {\n            const error = new googleError_1.GoogleError('cancelled');\n            error.code = status_1.Status.CANCELLED;\n            this.callback(error);\n        }\n    }\n    /**\n     * Call calls the specified function. Result will be used to fulfill\n     * the promise.\n     *\n     * @param {SimpleCallbackFunction} func\n     *   A function for an API call.\n     * @param {Object} argument\n     *   A request object.\n     */\n    call(func, argument) {\n        if (this.completed) {\n            return;\n        }\n        // eslint-disable-next-line\n        const canceller = func(argument, (...args) => {\n            this.completed = true;\n            setImmediate(this.callback, ...args);\n        });\n        this.cancelFunc = () => canceller.cancel();\n    }\n}\nexports.OngoingCall = OngoingCall;\nclass OngoingCallPromise extends OngoingCall {\n    /**\n     * GaxPromise is GRPCCallbackWrapper, but it holds a promise when\n     * the API call finishes.\n     * @constructor\n     * @private\n     */\n    constructor() {\n        let resolveCallback;\n        let rejectCallback;\n        const callback = (err, response, next, rawResponse) => {\n            if (err) {\n                rejectCallback(err);\n            }\n            else if (response !== undefined) {\n                resolveCallback([response, next || null, rawResponse || null]);\n            }\n            else {\n                throw new googleError_1.GoogleError('Neither error nor response are defined');\n            }\n        };\n        const promise = new Promise((resolve, reject) => {\n            resolveCallback = resolve;\n            rejectCallback = reject;\n        });\n        super(callback);\n        this.promise = promise;\n        this.promise.cancel = () => {\n            this.cancel();\n        };\n    }\n}\nexports.OngoingCallPromise = OngoingCallPromise;\n//# sourceMappingURL=call.js.map"]},"metadata":{},"sourceType":"script"}