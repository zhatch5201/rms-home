{"ast":null,"code":"\"use strict\";\n/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nvar _regeneratorRuntime = require(\"C:/Users/Zack/Desktop/rms-home/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _slicedToArray = require(\"C:/Users/Zack/Desktop/rms-home/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/slicedToArray\");\n\nvar _createForOfIteratorHelper = require(\"C:/Users/Zack/Desktop/rms-home/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createForOfIteratorHelper\");\n\nvar _asyncToGenerator = require(\"C:/Users/Zack/Desktop/rms-home/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar _toConsumableArray = require(\"C:/Users/Zack/Desktop/rms-home/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/toConsumableArray\");\n\nvar _classCallCheck = require(\"C:/Users/Zack/Desktop/rms-home/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"C:/Users/Zack/Desktop/rms-home/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _a, _b;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.fallback = exports.protobuf = exports.createApiCall = exports.lro = exports.GrpcClient = exports.version = exports.routingHeader = void 0; // Not all browsers support `TextEncoder`. The following `require` will\n// provide a fast UTF8-only replacement for those browsers that don't support\n// text encoding natively.\n\nvar isbrowser_1 = require(\"./isbrowser\");\n\nvar needTextEncoderPolyfill = false;\n\nif (isbrowser_1.isBrowser() && ( // eslint-disable-next-line node/no-unsupported-features/node-builtins\ntypeof TextEncoder === 'undefined' || typeof TextDecoder === 'undefined')) {\n  needTextEncoderPolyfill = true;\n}\n\nif (typeof process !== 'undefined' && ((_a = process === null || process === void 0 ? void 0 : process.versions) === null || _a === void 0 ? void 0 : _a.node) && ((_b = process === null || process === void 0 ? void 0 : process.versions) === null || _b === void 0 ? void 0 : _b.node.match(/^10\\./))) {\n  // Node.js 10 does not have global TextDecoder\n  // TODO(@alexander-fenster): remove this logic after Node.js 10 is EOL.\n  // eslint-disable-next-line @typescript-eslint/no-var-requires\n  var util = require('util');\n\n  Object.assign(global, {\n    TextDecoder: util.TextDecoder,\n    TextEncoder: util.TextEncoder\n  });\n}\n\nif (needTextEncoderPolyfill) {\n  require('fast-text-encoding');\n}\n\nvar protobuf = require(\"protobufjs\");\n\nexports.protobuf = protobuf;\n\nvar gax = require(\"./gax\");\n\nvar nodeFetch = require(\"node-fetch\");\n\nvar routingHeader = require(\"./routingHeader\");\n\nexports.routingHeader = routingHeader;\n\nvar abort_controller_1 = require(\"abort-controller\");\n\nvar status_1 = require(\"./status\");\n\nvar google_auth_library_1 = require(\"google-auth-library\");\n\nvar operationsClient_1 = require(\"./operationsClient\");\n\nvar createApiCall_1 = require(\"./createApiCall\");\n\nvar fallbackError_1 = require(\"./fallbackError\");\n\nvar transcoding_1 = require(\"./transcoding\");\n\nvar pathTemplate_1 = require(\"./pathTemplate\");\n\nObject.defineProperty(exports, \"PathTemplate\", {\n  enumerable: true,\n  get: function get() {\n    return pathTemplate_1.PathTemplate;\n  }\n});\n\nvar gax_1 = require(\"./gax\");\n\nObject.defineProperty(exports, \"CallSettings\", {\n  enumerable: true,\n  get: function get() {\n    return gax_1.CallSettings;\n  }\n});\nObject.defineProperty(exports, \"constructSettings\", {\n  enumerable: true,\n  get: function get() {\n    return gax_1.constructSettings;\n  }\n});\nObject.defineProperty(exports, \"RetryOptions\", {\n  enumerable: true,\n  get: function get() {\n    return gax_1.RetryOptions;\n  }\n});\nexports.version = require('../../package.json').version + '-fallback';\n\nvar descriptor_1 = require(\"./descriptor\");\n\nObject.defineProperty(exports, \"BundleDescriptor\", {\n  enumerable: true,\n  get: function get() {\n    return descriptor_1.BundleDescriptor;\n  }\n});\nObject.defineProperty(exports, \"LongrunningDescriptor\", {\n  enumerable: true,\n  get: function get() {\n    return descriptor_1.LongrunningDescriptor;\n  }\n});\nObject.defineProperty(exports, \"PageDescriptor\", {\n  enumerable: true,\n  get: function get() {\n    return descriptor_1.PageDescriptor;\n  }\n});\nObject.defineProperty(exports, \"StreamDescriptor\", {\n  enumerable: true,\n  get: function get() {\n    return descriptor_1.StreamDescriptor;\n  }\n});\n\nvar streaming_1 = require(\"./streamingCalls/streaming\");\n\nObject.defineProperty(exports, \"StreamType\", {\n  enumerable: true,\n  get: function get() {\n    return streaming_1.StreamType;\n  }\n});\nvar CLIENT_VERSION_HEADER = 'x-goog-api-client';\n\nvar GrpcClient = /*#__PURE__*/function () {\n  /**\n   * gRPC-fallback version of GrpcClient\n   * Implements GrpcClient API for a browser using grpc-fallback protocol (sends serialized protobuf to HTTP/1 $rpc endpoint).\n   *\n   * @param {Object=} options.auth - An instance of OAuth2Client to use in browser, or an instance of GoogleAuth from google-auth-library\n   *  to use in Node.js. Required for browser, optional for Node.js.\n   * @constructor\n   */\n  function GrpcClient() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, GrpcClient);\n\n    if (isbrowser_1.isBrowser()) {\n      if (!options.auth) {\n        throw new Error(JSON.stringify(options) + 'You need to pass auth instance to use gRPC-fallback client in browser. Use OAuth2Client from google-auth-library.');\n      }\n\n      this.auth = options.auth;\n    } else {\n      this.auth = options.auth || new google_auth_library_1.GoogleAuth(options);\n    }\n\n    this.fallback = options.fallback !== 'rest' ? 'proto' : 'rest';\n    this.grpcVersion = 'fallback'; // won't be used anywhere but we need it to exist in the class\n  }\n  /**\n   * gRPC-fallback version of loadProto\n   * Loads the protobuf root object from a JSON object created from a proto file\n   * @param {Object} jsonObject - A JSON version of a protofile created usin protobuf.js\n   * @returns {Object} Root namespace of proto JSON\n   */\n\n\n  _createClass(GrpcClient, [{\n    key: \"loadProto\",\n    value: function loadProto(jsonObject) {\n      var rootObject = protobuf.Root.fromJSON(jsonObject);\n      return rootObject;\n    }\n  }, {\n    key: \"getServiceMethods\",\n    value: function getServiceMethods(service) {\n      var methods = Object.keys(service.methods);\n      var methodsLowerCamelCase = methods.map(function (method) {\n        return method[0].toLowerCase() + method.substring(1);\n      });\n      return methodsLowerCamelCase;\n    }\n    /**\n     * gRPC-fallback version of constructSettings\n     * A wrapper of {@link constructSettings} function under the gRPC context.\n     *\n     * Most of parameters are common among constructSettings, please take a look.\n     * @param {string} serviceName - The fullly-qualified name of the service.\n     * @param {Object} clientConfig - A dictionary of the client config.\n     * @param {Object} configOverrides - A dictionary of overriding configs.\n     * @param {Object} headers - A dictionary of additional HTTP header name to\n     *   its value.\n     * @return {Object} A mapping of method names to CallSettings.\n     */\n\n  }, {\n    key: \"constructSettings\",\n    value: function constructSettings(serviceName, clientConfig, configOverrides, headers) {\n      function buildMetadata(abTests, moreHeaders) {\n        var metadata = {};\n\n        if (!headers) {\n          headers = {};\n        } // Since gRPC expects each header to be an array,\n        // we are doing the same for fallback here.\n\n\n        for (var key in headers) {\n          metadata[key] = Array.isArray(headers[key]) ? headers[key] : [headers[key]];\n        } // gRPC-fallback request must have 'grpc-web/' in 'x-goog-api-client'\n\n\n        var clientVersions = [];\n\n        if (metadata[CLIENT_VERSION_HEADER] && metadata[CLIENT_VERSION_HEADER][0]) {\n          clientVersions.push.apply(clientVersions, _toConsumableArray(metadata[CLIENT_VERSION_HEADER][0].split(' ')));\n        }\n\n        clientVersions.push(\"grpc-web/\".concat(exports.version));\n        metadata[CLIENT_VERSION_HEADER] = [clientVersions.join(' ')];\n\n        if (!moreHeaders) {\n          return metadata;\n        }\n\n        for (var _key in moreHeaders) {\n          if (_key.toLowerCase() !== CLIENT_VERSION_HEADER) {\n            var value = moreHeaders[_key];\n\n            if (Array.isArray(value)) {\n              if (metadata[_key] === undefined) {\n                metadata[_key] = value;\n              } else {\n                if (Array.isArray(metadata[_key])) {\n                  var _metadata$_key;\n\n                  (_metadata$_key = metadata[_key]).push.apply(_metadata$_key, _toConsumableArray(value));\n                } else {\n                  throw new Error(\"Can not add value \".concat(value, \" to the call metadata.\"));\n                }\n              }\n            } else {\n              metadata[_key] = [value];\n            }\n          }\n        }\n\n        return metadata;\n      }\n\n      return gax.constructSettings(serviceName, clientConfig, configOverrides, status_1.Status, {\n        metadataBuilder: buildMetadata\n      });\n    }\n    /**\n     * gRPC-fallback version of createStub\n     * Creates a gRPC-fallback stub with authentication headers built from supplied OAuth2Client instance\n     *\n     * @param {function} CreateStub - The constructor function of the stub.\n     * @param {Object} service - A protobufjs Service object (as returned by lookupService)\n     * @param {Object} opts - Connection options, as described below.\n     * @param {string} opts.servicePath - The hostname of the API endpoint service.\n     * @param {number} opts.port - The port of the service.\n     * @return {Promise} A promise which resolves to a gRPC-fallback service stub, which is a protobuf.js service stub instance modified to match the gRPC stub API\n     */\n\n  }, {\n    key: \"createStub\",\n    value: function () {\n      var _createStub = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(service, opts) {\n        var _this = this;\n\n        var serviceClientImpl, statusDecoder, authHeader, serviceStub, methods, newServiceStub, _iterator, _step, _loop;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                serviceClientImpl = function _serviceClientImpl(method, requestData, callback) {\n                  return [method, requestData, callback];\n                };\n\n                // decoder for google.rpc.Status messages\n                statusDecoder = new fallbackError_1.FallbackErrorDecoder();\n\n                if (this.authClient) {\n                  _context.next = 10;\n                  break;\n                }\n\n                if (!(this.auth && 'getClient' in this.auth)) {\n                  _context.next = 9;\n                  break;\n                }\n\n                _context.next = 6;\n                return this.auth.getClient();\n\n              case 6:\n                this.authClient = _context.sent;\n                _context.next = 10;\n                break;\n\n              case 9:\n                if (this.auth && 'getRequestHeaders' in this.auth) {\n                  this.authClient = this.auth;\n                }\n\n              case 10:\n                if (this.authClient) {\n                  _context.next = 12;\n                  break;\n                }\n\n                throw new Error('No authentication was provided');\n\n              case 12:\n                _context.next = 14;\n                return this.authClient.getRequestHeaders();\n\n              case 14:\n                authHeader = _context.sent;\n                serviceStub = service.create(serviceClientImpl, false, false);\n                methods = this.getServiceMethods(service);\n                newServiceStub = service.create(serviceClientImpl, false, false);\n                _iterator = _createForOfIteratorHelper(methods);\n\n                try {\n                  _loop = function _loop() {\n                    var methodName = _step.value;\n\n                    newServiceStub[methodName] = function (req, options, metadata, callback) {\n                      var _serviceStub$methodNa = serviceStub[methodName].apply(serviceStub, [req, callback]),\n                          _serviceStub$methodNa2 = _slicedToArray(_serviceStub$methodNa, 3),\n                          method = _serviceStub$methodNa2[0],\n                          requestData = _serviceStub$methodNa2[1],\n                          serviceCallback = _serviceStub$methodNa2[2]; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n                      var cancelController, cancelSignal;\n\n                      if (isbrowser_1.isBrowser && typeof AbortController !== 'undefined') {\n                        // eslint-disable-next-line no-undef\n                        cancelController = new AbortController();\n                      } else {\n                        cancelController = new abort_controller_1.AbortController();\n                      }\n\n                      if (cancelController) {\n                        cancelSignal = cancelController.signal;\n                      }\n\n                      var cancelRequested = false;\n                      var headers = Object.assign({}, authHeader);\n\n                      for (var _i = 0, _Object$keys = Object.keys(options); _i < _Object$keys.length; _i++) {\n                        var key = _Object$keys[_i];\n                        headers[key] = options[key][0];\n                      }\n\n                      var grpcFallbackProtocol = opts.protocol || 'https';\n                      var servicePath = opts.servicePath;\n\n                      if (!servicePath && service.options && service.options['(google.api.default_host)']) {\n                        servicePath = service.options['(google.api.default_host)'];\n                      }\n\n                      if (!servicePath) {\n                        serviceCallback(new Error('Service path is undefined'));\n                        return;\n                      }\n\n                      var servicePort;\n                      var match = servicePath.match(/^(.*):(\\d+)$/);\n\n                      if (match) {\n                        servicePath = match[1];\n                        servicePort = match[2];\n                      }\n\n                      if (opts.port) {\n                        servicePort = opts.port;\n                      } else if (!servicePort) {\n                        servicePort = 443;\n                      }\n\n                      var protoNamespaces = [];\n                      var currNamespace = method.parent;\n\n                      while (currNamespace.name !== '') {\n                        protoNamespaces.unshift(currNamespace.name);\n                        currNamespace = currNamespace.parent;\n                      }\n\n                      var protoServiceName = protoNamespaces.join('.');\n                      var rpcName = method.name;\n                      var url;\n                      var data;\n                      var httpMethod; // TODO(@alexander-fenster): refactor this into separate function that prepares\n                      // request object for `fetch`.\n\n                      if (_this.fallback === 'rest') {\n                        // REGAPIC: JSON over HTTP/1 with gRPC trancoding\n                        headers['Content-Type'] = 'application/json';\n                        var decodedRequest = method.resolvedRequestType.decode(requestData);\n                        var requestJSON = method.resolvedRequestType.toObject( // TODO: use toJSON instead of toObject\n                        decodedRequest);\n                        var transcoded = transcoding_1.transcode(requestJSON, method.parsedOptions);\n\n                        if (!transcoded) {\n                          throw new Error(\"Cannot build HTTP request for \".concat(JSON.stringify(requestJSON), \", method: \").concat(method.name));\n                        }\n\n                        httpMethod = transcoded.httpMethod;\n                        data = JSON.stringify(transcoded.data);\n                        url = \"\".concat(grpcFallbackProtocol, \"://\").concat(servicePath, \":\").concat(servicePort, \"/\").concat(transcoded.url.replace(/^\\//, ''), \"?\").concat(transcoded.queryString);\n                      } else {\n                        // gRPC-fallback: proto over HTTP/1\n                        headers['Content-Type'] = 'application/x-protobuf';\n                        httpMethod = 'post';\n                        data = requestData;\n                        url = \"\".concat(grpcFallbackProtocol, \"://\").concat(servicePath, \":\").concat(servicePort, \"/$rpc/\").concat(protoServiceName, \"/\").concat(rpcName);\n                      }\n\n                      var fetch = isbrowser_1.isBrowser() ? // eslint-disable-next-line no-undef\n                      window.fetch : nodeFetch;\n                      var fetchRequest = {\n                        headers: headers,\n                        body: data,\n                        method: httpMethod,\n                        signal: cancelSignal\n                      };\n\n                      if (httpMethod === 'get' || httpMethod === 'delete' || httpMethod === 'head') {\n                        delete fetchRequest['body'];\n                      }\n\n                      fetch(url, fetchRequest).then(function (response) {\n                        return Promise.all([Promise.resolve(response.ok), response.arrayBuffer()]);\n                      }).then(function (_ref) {\n                        var _ref2 = _slicedToArray(_ref, 2),\n                            ok = _ref2[0],\n                            buffer = _ref2[1];\n\n                        // TODO(@alexander-fenster): response processing to be moved\n                        // to a separate function.\n                        if (_this.fallback === 'rest') {\n                          // REGAPIC: JSON over HTTP/1\n                          // eslint-disable-next-line node/no-unsupported-features/node-builtins\n                          var decodedString = new TextDecoder().decode(buffer);\n                          var response = JSON.parse(decodedString);\n\n                          if (!ok) {\n                            var error = Object.assign(new Error(response['error']['message']), response.error);\n                            throw error;\n                          }\n\n                          var message = method.resolvedResponseType.fromObject(response);\n                          var encoded = method.resolvedResponseType.encode(message).finish();\n                          serviceCallback(null, encoded);\n                        } else {\n                          // gRPC-fallback: proto over HTTP/1\n                          if (!ok) {\n                            var _error = statusDecoder.decodeErrorFromBuffer(buffer);\n\n                            throw _error;\n                          }\n\n                          serviceCallback(null, new Uint8Array(buffer));\n                        }\n                      }).catch(function (err) {\n                        if (!cancelRequested || err.name !== 'AbortError') {\n                          serviceCallback(err);\n                        }\n                      });\n                      return {\n                        cancel: function cancel() {\n                          if (!cancelController) {\n                            console.warn('AbortController not found: Cancellation is not supported in this environment');\n                            return;\n                          }\n\n                          cancelRequested = true;\n                          cancelController.abort();\n                        }\n                      };\n                    };\n                  };\n\n                  for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                    _loop();\n                  }\n                } catch (err) {\n                  _iterator.e(err);\n                } finally {\n                  _iterator.f();\n                }\n\n                return _context.abrupt(\"return\", newServiceStub);\n\n              case 21:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function createStub(_x, _x2) {\n        return _createStub.apply(this, arguments);\n      }\n\n      return createStub;\n    }()\n  }]);\n\n  return GrpcClient;\n}();\n\nexports.GrpcClient = GrpcClient;\n/**\n * gRPC-fallback version of lro\n *\n * @param {Object=} options.auth - An instance of google-auth-library.\n * @return {Object} A OperationsClientBuilder that will return a OperationsClient\n */\n\nfunction lro(options) {\n  options = Object.assign({\n    scopes: []\n  }, options);\n  var gaxGrpc = new GrpcClient(options);\n  return new operationsClient_1.OperationsClientBuilder(gaxGrpc);\n}\n\nexports.lro = lro;\n/**\n * gRPC-fallback version of createApiCall\n *\n * Converts an rpc call into an API call governed by the settings.\n *\n * In typical usage, `func` will be a promise to a callable used to make an rpc\n * request. This will mostly likely be a bound method from a request stub used\n * to make an rpc call. It is not a direct function but a Promise instance,\n * because of its asynchronism (typically, obtaining the auth information).\n *\n * The result is a function which manages the API call with the given settings\n * and the options on the invocation.\n *\n * Throws exception on unsupported streaming calls\n *\n * @param {Promise<GRPCCall>|GRPCCall} func - is either a promise to be used to make\n *   a bare RPC call, or just a bare RPC call.\n * @param {CallSettings} settings - provides the settings for this call\n * @param {Descriptor} descriptor - optionally specify the descriptor for\n *   the method call.\n * @return {GaxCall} func - a bound method on a request stub used\n *   to make an rpc call.\n */\n\nfunction createApiCall(func, settings, descriptor) {\n  if (descriptor && 'streaming' in descriptor) {\n    return function () {\n      throw new Error('The gRPC-fallback client library (e.g. browser version of the library) currently does not support streaming calls.');\n    };\n  }\n\n  return createApiCall_1.createApiCall(func, settings, descriptor);\n}\n\nexports.createApiCall = createApiCall;\nexports.protobufMinimal = require(\"protobufjs/minimal\"); // Different environments or bundlers may or may not respect \"browser\" field\n// in package.json (e.g. Electron does not respect it, but if you run the code\n// through webpack first, it will follow the \"browser\" field).\n// To make it safer and more compatible, let's make sure that if you do\n// const gax = require(\"google-gax\");\n// you can always ask for gax.fallback, regardless of \"browser\" field being\n// understood or not.\n\nvar fallback = module.exports;\nexports.fallback = fallback;","map":{"version":3,"sources":["../../src/fallback.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\n/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar _a, _b;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.fallback = exports.protobuf = exports.createApiCall = exports.lro = exports.GrpcClient = exports.version = exports.routingHeader = void 0;\n// Not all browsers support `TextEncoder`. The following `require` will\n// provide a fast UTF8-only replacement for those browsers that don't support\n// text encoding natively.\nconst isbrowser_1 = require(\"./isbrowser\");\nlet needTextEncoderPolyfill = false;\nif (isbrowser_1.isBrowser() &&\n    // eslint-disable-next-line node/no-unsupported-features/node-builtins\n    (typeof TextEncoder === 'undefined' || typeof TextDecoder === 'undefined')) {\n    needTextEncoderPolyfill = true;\n}\nif (typeof process !== 'undefined' && ((_a = process === null || process === void 0 ? void 0 : process.versions) === null || _a === void 0 ? void 0 : _a.node) && ((_b = process === null || process === void 0 ? void 0 : process.versions) === null || _b === void 0 ? void 0 : _b.node.match(/^10\\./))) {\n    // Node.js 10 does not have global TextDecoder\n    // TODO(@alexander-fenster): remove this logic after Node.js 10 is EOL.\n    // eslint-disable-next-line @typescript-eslint/no-var-requires\n    const util = require('util');\n    Object.assign(global, {\n        TextDecoder: util.TextDecoder,\n        TextEncoder: util.TextEncoder,\n    });\n}\nif (needTextEncoderPolyfill) {\n    require('fast-text-encoding');\n}\nconst protobuf = require(\"protobufjs\");\nexports.protobuf = protobuf;\nconst gax = require(\"./gax\");\nconst nodeFetch = require(\"node-fetch\");\nconst routingHeader = require(\"./routingHeader\");\nexports.routingHeader = routingHeader;\nconst abort_controller_1 = require(\"abort-controller\");\nconst status_1 = require(\"./status\");\nconst google_auth_library_1 = require(\"google-auth-library\");\nconst operationsClient_1 = require(\"./operationsClient\");\nconst createApiCall_1 = require(\"./createApiCall\");\nconst fallbackError_1 = require(\"./fallbackError\");\nconst transcoding_1 = require(\"./transcoding\");\nvar pathTemplate_1 = require(\"./pathTemplate\");\nObject.defineProperty(exports, \"PathTemplate\", { enumerable: true, get: function () { return pathTemplate_1.PathTemplate; } });\nvar gax_1 = require(\"./gax\");\nObject.defineProperty(exports, \"CallSettings\", { enumerable: true, get: function () { return gax_1.CallSettings; } });\nObject.defineProperty(exports, \"constructSettings\", { enumerable: true, get: function () { return gax_1.constructSettings; } });\nObject.defineProperty(exports, \"RetryOptions\", { enumerable: true, get: function () { return gax_1.RetryOptions; } });\nexports.version = require('../../package.json').version + '-fallback';\nvar descriptor_1 = require(\"./descriptor\");\nObject.defineProperty(exports, \"BundleDescriptor\", { enumerable: true, get: function () { return descriptor_1.BundleDescriptor; } });\nObject.defineProperty(exports, \"LongrunningDescriptor\", { enumerable: true, get: function () { return descriptor_1.LongrunningDescriptor; } });\nObject.defineProperty(exports, \"PageDescriptor\", { enumerable: true, get: function () { return descriptor_1.PageDescriptor; } });\nObject.defineProperty(exports, \"StreamDescriptor\", { enumerable: true, get: function () { return descriptor_1.StreamDescriptor; } });\nvar streaming_1 = require(\"./streamingCalls/streaming\");\nObject.defineProperty(exports, \"StreamType\", { enumerable: true, get: function () { return streaming_1.StreamType; } });\nconst CLIENT_VERSION_HEADER = 'x-goog-api-client';\nclass GrpcClient {\n    /**\n     * gRPC-fallback version of GrpcClient\n     * Implements GrpcClient API for a browser using grpc-fallback protocol (sends serialized protobuf to HTTP/1 $rpc endpoint).\n     *\n     * @param {Object=} options.auth - An instance of OAuth2Client to use in browser, or an instance of GoogleAuth from google-auth-library\n     *  to use in Node.js. Required for browser, optional for Node.js.\n     * @constructor\n     */\n    constructor(options = {}) {\n        if (isbrowser_1.isBrowser()) {\n            if (!options.auth) {\n                throw new Error(JSON.stringify(options) +\n                    'You need to pass auth instance to use gRPC-fallback client in browser. Use OAuth2Client from google-auth-library.');\n            }\n            this.auth = options.auth;\n        }\n        else {\n            this.auth =\n                options.auth ||\n                    new google_auth_library_1.GoogleAuth(options);\n        }\n        this.fallback = options.fallback !== 'rest' ? 'proto' : 'rest';\n        this.grpcVersion = 'fallback'; // won't be used anywhere but we need it to exist in the class\n    }\n    /**\n     * gRPC-fallback version of loadProto\n     * Loads the protobuf root object from a JSON object created from a proto file\n     * @param {Object} jsonObject - A JSON version of a protofile created usin protobuf.js\n     * @returns {Object} Root namespace of proto JSON\n     */\n    loadProto(jsonObject) {\n        const rootObject = protobuf.Root.fromJSON(jsonObject);\n        return rootObject;\n    }\n    getServiceMethods(service) {\n        const methods = Object.keys(service.methods);\n        const methodsLowerCamelCase = methods.map(method => {\n            return method[0].toLowerCase() + method.substring(1);\n        });\n        return methodsLowerCamelCase;\n    }\n    /**\n     * gRPC-fallback version of constructSettings\n     * A wrapper of {@link constructSettings} function under the gRPC context.\n     *\n     * Most of parameters are common among constructSettings, please take a look.\n     * @param {string} serviceName - The fullly-qualified name of the service.\n     * @param {Object} clientConfig - A dictionary of the client config.\n     * @param {Object} configOverrides - A dictionary of overriding configs.\n     * @param {Object} headers - A dictionary of additional HTTP header name to\n     *   its value.\n     * @return {Object} A mapping of method names to CallSettings.\n     */\n    constructSettings(serviceName, clientConfig, configOverrides, headers) {\n        function buildMetadata(abTests, moreHeaders) {\n            const metadata = {};\n            if (!headers) {\n                headers = {};\n            }\n            // Since gRPC expects each header to be an array,\n            // we are doing the same for fallback here.\n            for (const key in headers) {\n                metadata[key] = Array.isArray(headers[key])\n                    ? headers[key]\n                    : [headers[key]];\n            }\n            // gRPC-fallback request must have 'grpc-web/' in 'x-goog-api-client'\n            const clientVersions = [];\n            if (metadata[CLIENT_VERSION_HEADER] &&\n                metadata[CLIENT_VERSION_HEADER][0]) {\n                clientVersions.push(...metadata[CLIENT_VERSION_HEADER][0].split(' '));\n            }\n            clientVersions.push(`grpc-web/${exports.version}`);\n            metadata[CLIENT_VERSION_HEADER] = [clientVersions.join(' ')];\n            if (!moreHeaders) {\n                return metadata;\n            }\n            for (const key in moreHeaders) {\n                if (key.toLowerCase() !== CLIENT_VERSION_HEADER) {\n                    const value = moreHeaders[key];\n                    if (Array.isArray(value)) {\n                        if (metadata[key] === undefined) {\n                            metadata[key] = value;\n                        }\n                        else {\n                            if (Array.isArray(metadata[key])) {\n                                metadata[key].push(...value);\n                            }\n                            else {\n                                throw new Error(`Can not add value ${value} to the call metadata.`);\n                            }\n                        }\n                    }\n                    else {\n                        metadata[key] = [value];\n                    }\n                }\n            }\n            return metadata;\n        }\n        return gax.constructSettings(serviceName, clientConfig, configOverrides, status_1.Status, { metadataBuilder: buildMetadata });\n    }\n    /**\n     * gRPC-fallback version of createStub\n     * Creates a gRPC-fallback stub with authentication headers built from supplied OAuth2Client instance\n     *\n     * @param {function} CreateStub - The constructor function of the stub.\n     * @param {Object} service - A protobufjs Service object (as returned by lookupService)\n     * @param {Object} opts - Connection options, as described below.\n     * @param {string} opts.servicePath - The hostname of the API endpoint service.\n     * @param {number} opts.port - The port of the service.\n     * @return {Promise} A promise which resolves to a gRPC-fallback service stub, which is a protobuf.js service stub instance modified to match the gRPC stub API\n     */\n    async createStub(service, opts) {\n        // an RPC function to be passed to protobufjs RPC API\n        function serviceClientImpl(method, requestData, callback) {\n            return [method, requestData, callback];\n        }\n        // decoder for google.rpc.Status messages\n        const statusDecoder = new fallbackError_1.FallbackErrorDecoder();\n        if (!this.authClient) {\n            if (this.auth && 'getClient' in this.auth) {\n                this.authClient = await this.auth.getClient();\n            }\n            else if (this.auth && 'getRequestHeaders' in this.auth) {\n                this.authClient = this.auth;\n            }\n        }\n        if (!this.authClient) {\n            throw new Error('No authentication was provided');\n        }\n        const authHeader = await this.authClient.getRequestHeaders();\n        const serviceStub = service.create(serviceClientImpl, false, false);\n        const methods = this.getServiceMethods(service);\n        const newServiceStub = service.create(serviceClientImpl, false, false);\n        for (const methodName of methods) {\n            newServiceStub[methodName] = (req, options, metadata, callback) => {\n                const [method, requestData, serviceCallback] = serviceStub[methodName].apply(serviceStub, [req, callback]);\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                let cancelController, cancelSignal;\n                if (isbrowser_1.isBrowser && typeof AbortController !== 'undefined') {\n                    // eslint-disable-next-line no-undef\n                    cancelController = new AbortController();\n                }\n                else {\n                    cancelController = new abort_controller_1.AbortController();\n                }\n                if (cancelController) {\n                    cancelSignal = cancelController.signal;\n                }\n                let cancelRequested = false;\n                const headers = Object.assign({}, authHeader);\n                for (const key of Object.keys(options)) {\n                    headers[key] = options[key][0];\n                }\n                const grpcFallbackProtocol = opts.protocol || 'https';\n                let servicePath = opts.servicePath;\n                if (!servicePath &&\n                    service.options &&\n                    service.options['(google.api.default_host)']) {\n                    servicePath = service.options['(google.api.default_host)'];\n                }\n                if (!servicePath) {\n                    serviceCallback(new Error('Service path is undefined'));\n                    return;\n                }\n                let servicePort;\n                const match = servicePath.match(/^(.*):(\\d+)$/);\n                if (match) {\n                    servicePath = match[1];\n                    servicePort = match[2];\n                }\n                if (opts.port) {\n                    servicePort = opts.port;\n                }\n                else if (!servicePort) {\n                    servicePort = 443;\n                }\n                const protoNamespaces = [];\n                let currNamespace = method.parent;\n                while (currNamespace.name !== '') {\n                    protoNamespaces.unshift(currNamespace.name);\n                    currNamespace = currNamespace.parent;\n                }\n                const protoServiceName = protoNamespaces.join('.');\n                const rpcName = method.name;\n                let url;\n                let data;\n                let httpMethod;\n                // TODO(@alexander-fenster): refactor this into separate function that prepares\n                // request object for `fetch`.\n                if (this.fallback === 'rest') {\n                    // REGAPIC: JSON over HTTP/1 with gRPC trancoding\n                    headers['Content-Type'] = 'application/json';\n                    const decodedRequest = method.resolvedRequestType.decode(requestData);\n                    const requestJSON = method.resolvedRequestType.toObject(\n                    // TODO: use toJSON instead of toObject\n                    decodedRequest);\n                    const transcoded = transcoding_1.transcode(requestJSON, method.parsedOptions);\n                    if (!transcoded) {\n                        throw new Error(`Cannot build HTTP request for ${JSON.stringify(requestJSON)}, method: ${method.name}`);\n                    }\n                    httpMethod = transcoded.httpMethod;\n                    data = JSON.stringify(transcoded.data);\n                    url = `${grpcFallbackProtocol}://${servicePath}:${servicePort}/${transcoded.url.replace(/^\\//, '')}?${transcoded.queryString}`;\n                }\n                else {\n                    // gRPC-fallback: proto over HTTP/1\n                    headers['Content-Type'] = 'application/x-protobuf';\n                    httpMethod = 'post';\n                    data = requestData;\n                    url = `${grpcFallbackProtocol}://${servicePath}:${servicePort}/$rpc/${protoServiceName}/${rpcName}`;\n                }\n                const fetch = isbrowser_1.isBrowser()\n                    ? // eslint-disable-next-line no-undef\n                        window.fetch\n                    : nodeFetch;\n                const fetchRequest = {\n                    headers,\n                    body: data,\n                    method: httpMethod,\n                    signal: cancelSignal,\n                };\n                if (httpMethod === 'get' ||\n                    httpMethod === 'delete' ||\n                    httpMethod === 'head') {\n                    delete fetchRequest['body'];\n                }\n                fetch(url, fetchRequest)\n                    .then((response) => {\n                    return Promise.all([\n                        Promise.resolve(response.ok),\n                        response.arrayBuffer(),\n                    ]);\n                })\n                    .then(([ok, buffer]) => {\n                    // TODO(@alexander-fenster): response processing to be moved\n                    // to a separate function.\n                    if (this.fallback === 'rest') {\n                        // REGAPIC: JSON over HTTP/1\n                        // eslint-disable-next-line node/no-unsupported-features/node-builtins\n                        const decodedString = new TextDecoder().decode(buffer);\n                        const response = JSON.parse(decodedString);\n                        if (!ok) {\n                            const error = Object.assign(new Error(response['error']['message']), response.error);\n                            throw error;\n                        }\n                        const message = method.resolvedResponseType.fromObject(response);\n                        const encoded = method.resolvedResponseType\n                            .encode(message)\n                            .finish();\n                        serviceCallback(null, encoded);\n                    }\n                    else {\n                        // gRPC-fallback: proto over HTTP/1\n                        if (!ok) {\n                            const error = statusDecoder.decodeErrorFromBuffer(buffer);\n                            throw error;\n                        }\n                        serviceCallback(null, new Uint8Array(buffer));\n                    }\n                })\n                    .catch((err) => {\n                    if (!cancelRequested || err.name !== 'AbortError') {\n                        serviceCallback(err);\n                    }\n                });\n                return {\n                    cancel: () => {\n                        if (!cancelController) {\n                            console.warn('AbortController not found: Cancellation is not supported in this environment');\n                            return;\n                        }\n                        cancelRequested = true;\n                        cancelController.abort();\n                    },\n                };\n            };\n        }\n        return newServiceStub;\n    }\n}\nexports.GrpcClient = GrpcClient;\n/**\n * gRPC-fallback version of lro\n *\n * @param {Object=} options.auth - An instance of google-auth-library.\n * @return {Object} A OperationsClientBuilder that will return a OperationsClient\n */\nfunction lro(options) {\n    options = Object.assign({ scopes: [] }, options);\n    const gaxGrpc = new GrpcClient(options);\n    return new operationsClient_1.OperationsClientBuilder(gaxGrpc);\n}\nexports.lro = lro;\n/**\n * gRPC-fallback version of createApiCall\n *\n * Converts an rpc call into an API call governed by the settings.\n *\n * In typical usage, `func` will be a promise to a callable used to make an rpc\n * request. This will mostly likely be a bound method from a request stub used\n * to make an rpc call. It is not a direct function but a Promise instance,\n * because of its asynchronism (typically, obtaining the auth information).\n *\n * The result is a function which manages the API call with the given settings\n * and the options on the invocation.\n *\n * Throws exception on unsupported streaming calls\n *\n * @param {Promise<GRPCCall>|GRPCCall} func - is either a promise to be used to make\n *   a bare RPC call, or just a bare RPC call.\n * @param {CallSettings} settings - provides the settings for this call\n * @param {Descriptor} descriptor - optionally specify the descriptor for\n *   the method call.\n * @return {GaxCall} func - a bound method on a request stub used\n *   to make an rpc call.\n */\nfunction createApiCall(func, settings, descriptor) {\n    if (descriptor && 'streaming' in descriptor) {\n        return () => {\n            throw new Error('The gRPC-fallback client library (e.g. browser version of the library) currently does not support streaming calls.');\n        };\n    }\n    return createApiCall_1.createApiCall(func, settings, descriptor);\n}\nexports.createApiCall = createApiCall;\nexports.protobufMinimal = require(\"protobufjs/minimal\");\n// Different environments or bundlers may or may not respect \"browser\" field\n// in package.json (e.g. Electron does not respect it, but if you run the code\n// through webpack first, it will follow the \"browser\" field).\n// To make it safer and more compatible, let's make sure that if you do\n// const gax = require(\"google-gax\");\n// you can always ask for gax.fallback, regardless of \"browser\" field being\n// understood or not.\nconst fallback = module.exports;\nexports.fallback = fallback;\n//# sourceMappingURL=fallback.js.map"]},"metadata":{},"sourceType":"script"}