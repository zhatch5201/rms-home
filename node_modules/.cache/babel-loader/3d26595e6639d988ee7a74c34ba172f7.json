{"ast":null,"code":"/*! firebase-admin v9.5.0 */\n\"use strict\";\n/*!\n * Copyright 2020 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.DatabaseService = void 0;\n\nvar url_1 = require(\"url\");\n\nvar path = require(\"path\");\n\nvar error_1 = require(\"../utils/error\");\n\nvar validator = require(\"../utils/validator\");\n\nvar api_request_1 = require(\"../utils/api-request\");\n\nvar index_1 = require(\"../utils/index\");\n\nvar DatabaseService =\n/** @class */\nfunction () {\n  function DatabaseService(app) {\n    this.databases = {};\n\n    if (!validator.isNonNullObject(app) || !('options' in app)) {\n      throw new error_1.FirebaseDatabaseError({\n        code: 'invalid-argument',\n        message: 'First argument passed to admin.database() must be a valid Firebase app instance.'\n      });\n    }\n\n    this.appInternal = app;\n  }\n  /**\n   * @internal\n   */\n\n\n  DatabaseService.prototype.delete = function () {\n    var _this = this;\n\n    var promises = [];\n\n    for (var _i = 0, _a = Object.keys(this.databases); _i < _a.length; _i++) {\n      var dbUrl = _a[_i];\n      var db = this.databases[dbUrl];\n      promises.push(db.INTERNAL.delete());\n    }\n\n    return Promise.all(promises).then(function () {\n      _this.databases = {};\n    });\n  };\n\n  Object.defineProperty(DatabaseService.prototype, \"app\", {\n    /**\n     * Returns the app associated with this DatabaseService instance.\n     *\n     * @return {FirebaseApp} The app associated with this DatabaseService instance.\n     */\n    get: function get() {\n      return this.appInternal;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  DatabaseService.prototype.getDatabase = function (url) {\n    var dbUrl = this.ensureUrl(url);\n\n    if (!validator.isNonEmptyString(dbUrl)) {\n      throw new error_1.FirebaseDatabaseError({\n        code: 'invalid-argument',\n        message: 'Database URL must be a valid, non-empty URL string.'\n      });\n    }\n\n    var db = this.databases[dbUrl];\n\n    if (typeof db === 'undefined') {\n      var rtdb = require('@firebase/database'); // eslint-disable-line @typescript-eslint/no-var-requires\n\n\n      db = rtdb.initStandalone(this.appInternal, dbUrl, index_1.getSdkVersion()).instance;\n      var rulesClient_1 = new DatabaseRulesClient(this.app, dbUrl);\n\n      db.getRules = function () {\n        return rulesClient_1.getRules();\n      };\n\n      db.getRulesJSON = function () {\n        return rulesClient_1.getRulesJSON();\n      };\n\n      db.setRules = function (source) {\n        return rulesClient_1.setRules(source);\n      };\n\n      this.databases[dbUrl] = db;\n    }\n\n    return db;\n  };\n\n  DatabaseService.prototype.ensureUrl = function (url) {\n    if (typeof url !== 'undefined') {\n      return url;\n    } else if (typeof this.appInternal.options.databaseURL !== 'undefined') {\n      return this.appInternal.options.databaseURL;\n    }\n\n    throw new error_1.FirebaseDatabaseError({\n      code: 'invalid-argument',\n      message: 'Can\\'t determine Firebase Database URL.'\n    });\n  };\n\n  return DatabaseService;\n}();\n\nexports.DatabaseService = DatabaseService;\nvar RULES_URL_PATH = '.settings/rules.json';\n/**\n * A helper client for managing RTDB security rules.\n */\n\nvar DatabaseRulesClient =\n/** @class */\nfunction () {\n  function DatabaseRulesClient(app, dbUrl) {\n    var parsedUrl = new url_1.URL(dbUrl);\n    parsedUrl.pathname = path.join(parsedUrl.pathname, RULES_URL_PATH);\n    this.dbUrl = parsedUrl.toString();\n    this.httpClient = new api_request_1.AuthorizedHttpClient(app);\n  }\n  /**\n   * Gets the currently applied security rules as a string. The return value consists of\n   * the rules source including comments.\n   *\n   * @return {Promise<string>} A promise fulfilled with the rules as a raw string.\n   */\n\n\n  DatabaseRulesClient.prototype.getRules = function () {\n    var _this = this;\n\n    var req = {\n      method: 'GET',\n      url: this.dbUrl\n    };\n    return this.httpClient.send(req).then(function (resp) {\n      if (!resp.text) {\n        throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INTERNAL_ERROR, 'HTTP response missing data.');\n      }\n\n      return resp.text;\n    }).catch(function (err) {\n      throw _this.handleError(err);\n    });\n  };\n  /**\n   * Gets the currently applied security rules as a parsed JSON object. Any comments in\n   * the original source are stripped away.\n   *\n   * @return {Promise<object>} A promise fulfilled with the parsed rules source.\n   */\n\n\n  DatabaseRulesClient.prototype.getRulesJSON = function () {\n    var _this = this;\n\n    var req = {\n      method: 'GET',\n      url: this.dbUrl,\n      data: {\n        format: 'strict'\n      }\n    };\n    return this.httpClient.send(req).then(function (resp) {\n      return resp.data;\n    }).catch(function (err) {\n      throw _this.handleError(err);\n    });\n  };\n  /**\n   * Sets the specified rules on the Firebase Database instance. If the rules source is\n   * specified as a string or a Buffer, it may include comments.\n   *\n   * @param {string|Buffer|object} source Source of the rules to apply. Must not be `null`\n   *  or empty.\n   * @return {Promise<void>} Resolves when the rules are set on the Database.\n   */\n\n\n  DatabaseRulesClient.prototype.setRules = function (source) {\n    var _this = this;\n\n    if (!validator.isNonEmptyString(source) && !validator.isBuffer(source) && !validator.isNonNullObject(source)) {\n      var error = new error_1.FirebaseDatabaseError({\n        code: 'invalid-argument',\n        message: 'Source must be a non-empty string, Buffer or an object.'\n      });\n      return Promise.reject(error);\n    }\n\n    var req = {\n      method: 'PUT',\n      url: this.dbUrl,\n      data: source,\n      headers: {\n        'content-type': 'application/json; charset=utf-8'\n      }\n    };\n    return this.httpClient.send(req).then(function () {\n      return;\n    }).catch(function (err) {\n      throw _this.handleError(err);\n    });\n  };\n\n  DatabaseRulesClient.prototype.handleError = function (err) {\n    if (err instanceof api_request_1.HttpError) {\n      return new error_1.FirebaseDatabaseError({\n        code: error_1.AppErrorCodes.INTERNAL_ERROR,\n        message: this.getErrorMessage(err)\n      });\n    }\n\n    return err;\n  };\n\n  DatabaseRulesClient.prototype.getErrorMessage = function (err) {\n    var intro = 'Error while accessing security rules';\n\n    try {\n      var body = err.response.data;\n\n      if (body && body.error) {\n        return intro + \": \" + body.error.trim();\n      }\n    } catch (_a) {// Ignore parsing errors\n    }\n\n    return intro + \": \" + err.response.text;\n  };\n\n  return DatabaseRulesClient;\n}();","map":{"version":3,"sources":["C:/Users/Zack/Desktop/rms-home/node_modules/firebase-admin/lib/database/database-internal.js"],"names":["Object","defineProperty","exports","value","DatabaseService","url_1","require","path","error_1","validator","api_request_1","index_1","app","databases","isNonNullObject","FirebaseDatabaseError","code","message","appInternal","prototype","delete","_this","promises","_i","_a","keys","length","dbUrl","db","push","INTERNAL","Promise","all","then","get","enumerable","configurable","getDatabase","url","ensureUrl","isNonEmptyString","rtdb","initStandalone","getSdkVersion","instance","rulesClient_1","DatabaseRulesClient","getRules","getRulesJSON","setRules","source","options","databaseURL","RULES_URL_PATH","parsedUrl","URL","pathname","join","toString","httpClient","AuthorizedHttpClient","req","method","send","resp","text","FirebaseAppError","AppErrorCodes","INTERNAL_ERROR","catch","err","handleError","data","format","isBuffer","error","reject","headers","HttpError","getErrorMessage","intro","body","response","trim"],"mappings":"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","sourcesContent":["/*! firebase-admin v9.5.0 */\n\"use strict\";\n/*!\n * Copyright 2020 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.DatabaseService = void 0;\nvar url_1 = require(\"url\");\nvar path = require(\"path\");\nvar error_1 = require(\"../utils/error\");\nvar validator = require(\"../utils/validator\");\nvar api_request_1 = require(\"../utils/api-request\");\nvar index_1 = require(\"../utils/index\");\nvar DatabaseService = /** @class */ (function () {\n    function DatabaseService(app) {\n        this.databases = {};\n        if (!validator.isNonNullObject(app) || !('options' in app)) {\n            throw new error_1.FirebaseDatabaseError({\n                code: 'invalid-argument',\n                message: 'First argument passed to admin.database() must be a valid Firebase app instance.',\n            });\n        }\n        this.appInternal = app;\n    }\n    /**\n     * @internal\n     */\n    DatabaseService.prototype.delete = function () {\n        var _this = this;\n        var promises = [];\n        for (var _i = 0, _a = Object.keys(this.databases); _i < _a.length; _i++) {\n            var dbUrl = _a[_i];\n            var db = this.databases[dbUrl];\n            promises.push(db.INTERNAL.delete());\n        }\n        return Promise.all(promises).then(function () {\n            _this.databases = {};\n        });\n    };\n    Object.defineProperty(DatabaseService.prototype, \"app\", {\n        /**\n         * Returns the app associated with this DatabaseService instance.\n         *\n         * @return {FirebaseApp} The app associated with this DatabaseService instance.\n         */\n        get: function () {\n            return this.appInternal;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    DatabaseService.prototype.getDatabase = function (url) {\n        var dbUrl = this.ensureUrl(url);\n        if (!validator.isNonEmptyString(dbUrl)) {\n            throw new error_1.FirebaseDatabaseError({\n                code: 'invalid-argument',\n                message: 'Database URL must be a valid, non-empty URL string.',\n            });\n        }\n        var db = this.databases[dbUrl];\n        if (typeof db === 'undefined') {\n            var rtdb = require('@firebase/database'); // eslint-disable-line @typescript-eslint/no-var-requires\n            db = rtdb.initStandalone(this.appInternal, dbUrl, index_1.getSdkVersion()).instance;\n            var rulesClient_1 = new DatabaseRulesClient(this.app, dbUrl);\n            db.getRules = function () {\n                return rulesClient_1.getRules();\n            };\n            db.getRulesJSON = function () {\n                return rulesClient_1.getRulesJSON();\n            };\n            db.setRules = function (source) {\n                return rulesClient_1.setRules(source);\n            };\n            this.databases[dbUrl] = db;\n        }\n        return db;\n    };\n    DatabaseService.prototype.ensureUrl = function (url) {\n        if (typeof url !== 'undefined') {\n            return url;\n        }\n        else if (typeof this.appInternal.options.databaseURL !== 'undefined') {\n            return this.appInternal.options.databaseURL;\n        }\n        throw new error_1.FirebaseDatabaseError({\n            code: 'invalid-argument',\n            message: 'Can\\'t determine Firebase Database URL.',\n        });\n    };\n    return DatabaseService;\n}());\nexports.DatabaseService = DatabaseService;\nvar RULES_URL_PATH = '.settings/rules.json';\n/**\n * A helper client for managing RTDB security rules.\n */\nvar DatabaseRulesClient = /** @class */ (function () {\n    function DatabaseRulesClient(app, dbUrl) {\n        var parsedUrl = new url_1.URL(dbUrl);\n        parsedUrl.pathname = path.join(parsedUrl.pathname, RULES_URL_PATH);\n        this.dbUrl = parsedUrl.toString();\n        this.httpClient = new api_request_1.AuthorizedHttpClient(app);\n    }\n    /**\n     * Gets the currently applied security rules as a string. The return value consists of\n     * the rules source including comments.\n     *\n     * @return {Promise<string>} A promise fulfilled with the rules as a raw string.\n     */\n    DatabaseRulesClient.prototype.getRules = function () {\n        var _this = this;\n        var req = {\n            method: 'GET',\n            url: this.dbUrl,\n        };\n        return this.httpClient.send(req)\n            .then(function (resp) {\n            if (!resp.text) {\n                throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INTERNAL_ERROR, 'HTTP response missing data.');\n            }\n            return resp.text;\n        })\n            .catch(function (err) {\n            throw _this.handleError(err);\n        });\n    };\n    /**\n     * Gets the currently applied security rules as a parsed JSON object. Any comments in\n     * the original source are stripped away.\n     *\n     * @return {Promise<object>} A promise fulfilled with the parsed rules source.\n     */\n    DatabaseRulesClient.prototype.getRulesJSON = function () {\n        var _this = this;\n        var req = {\n            method: 'GET',\n            url: this.dbUrl,\n            data: { format: 'strict' },\n        };\n        return this.httpClient.send(req)\n            .then(function (resp) {\n            return resp.data;\n        })\n            .catch(function (err) {\n            throw _this.handleError(err);\n        });\n    };\n    /**\n     * Sets the specified rules on the Firebase Database instance. If the rules source is\n     * specified as a string or a Buffer, it may include comments.\n     *\n     * @param {string|Buffer|object} source Source of the rules to apply. Must not be `null`\n     *  or empty.\n     * @return {Promise<void>} Resolves when the rules are set on the Database.\n     */\n    DatabaseRulesClient.prototype.setRules = function (source) {\n        var _this = this;\n        if (!validator.isNonEmptyString(source) &&\n            !validator.isBuffer(source) &&\n            !validator.isNonNullObject(source)) {\n            var error = new error_1.FirebaseDatabaseError({\n                code: 'invalid-argument',\n                message: 'Source must be a non-empty string, Buffer or an object.',\n            });\n            return Promise.reject(error);\n        }\n        var req = {\n            method: 'PUT',\n            url: this.dbUrl,\n            data: source,\n            headers: {\n                'content-type': 'application/json; charset=utf-8',\n            },\n        };\n        return this.httpClient.send(req)\n            .then(function () {\n            return;\n        })\n            .catch(function (err) {\n            throw _this.handleError(err);\n        });\n    };\n    DatabaseRulesClient.prototype.handleError = function (err) {\n        if (err instanceof api_request_1.HttpError) {\n            return new error_1.FirebaseDatabaseError({\n                code: error_1.AppErrorCodes.INTERNAL_ERROR,\n                message: this.getErrorMessage(err),\n            });\n        }\n        return err;\n    };\n    DatabaseRulesClient.prototype.getErrorMessage = function (err) {\n        var intro = 'Error while accessing security rules';\n        try {\n            var body = err.response.data;\n            if (body && body.error) {\n                return intro + \": \" + body.error.trim();\n            }\n        }\n        catch (_a) {\n            // Ignore parsing errors\n        }\n        return intro + \": \" + err.response.text;\n    };\n    return DatabaseRulesClient;\n}());\n"]},"metadata":{},"sourceType":"script"}