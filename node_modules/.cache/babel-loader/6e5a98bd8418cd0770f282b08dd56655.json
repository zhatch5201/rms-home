{"ast":null,"code":"\"use strict\";\n/*!\n * Copyright 2019 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nvar _createForOfIteratorHelper = require(\"C:/Users/Zack/Desktop/rms-home/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createForOfIteratorHelper\");\n\nvar _classCallCheck = require(\"C:/Users/Zack/Desktop/rms-home/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"C:/Users/Zack/Desktop/rms-home/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar convert_1 = require(\"./convert\");\n\nvar field_value_1 = require(\"./field-value\");\n\nvar geo_point_1 = require(\"./geo-point\");\n\nvar index_1 = require(\"./index\");\n\nvar path_1 = require(\"./path\");\n\nvar timestamp_1 = require(\"./timestamp\");\n\nvar util_1 = require(\"./util\");\n\nvar validate_1 = require(\"./validate\");\n/**\n * The maximum depth of a Firestore object.\n *\n * @private\n */\n\n\nvar MAX_DEPTH = 20;\n/**\n * Serializer that is used to convert between JavaScript types and their\n * Firestore Protobuf representation.\n *\n * @private\n */\n\nvar Serializer = /*#__PURE__*/function () {\n  function Serializer(firestore) {\n    _classCallCheck(this, Serializer);\n\n    // Instead of storing the `firestore` object, we store just a reference to\n    // its `.doc()` method. This avoid a circular reference, which breaks\n    // JSON.stringify().\n    this.createReference = function (path) {\n      return firestore.doc(path);\n    };\n\n    this.createInteger = function (n) {\n      return firestore._settings.useBigInt ? BigInt(n) : Number(n);\n    };\n\n    this.allowUndefined = !!firestore._settings.ignoreUndefinedProperties;\n  }\n  /**\n   * Encodes a JavaScript object into the Firestore 'Fields' representation.\n   *\n   * @private\n   * @param obj The object to encode.\n   * @returns The Firestore 'Fields' representation\n   */\n\n\n  _createClass(Serializer, [{\n    key: \"encodeFields\",\n    value: function encodeFields(obj) {\n      var fields = {};\n\n      for (var _i = 0, _Object$keys = Object.keys(obj); _i < _Object$keys.length; _i++) {\n        var prop = _Object$keys[_i];\n        var val = this.encodeValue(obj[prop]);\n\n        if (val) {\n          fields[prop] = val;\n        }\n      }\n\n      return fields;\n    }\n    /**\n     * Encodes a JavaScript value into the Firestore 'Value' representation.\n     *\n     * @private\n     * @param val The object to encode\n     * @returns The Firestore Proto or null if we are deleting a field.\n     */\n\n  }, {\n    key: \"encodeValue\",\n    value: function encodeValue(val) {\n      if (val instanceof field_value_1.FieldTransform) {\n        return null;\n      }\n\n      if (typeof val === 'string') {\n        return {\n          stringValue: val\n        };\n      }\n\n      if (typeof val === 'boolean') {\n        return {\n          booleanValue: val\n        };\n      }\n\n      if (typeof val === 'number') {\n        if (Number.isSafeInteger(val)) {\n          return {\n            integerValue: val\n          };\n        } else {\n          return {\n            doubleValue: val\n          };\n        }\n      }\n\n      if (typeof val === 'bigint') {\n        return {\n          integerValue: val.toString()\n        };\n      }\n\n      if (val instanceof Date) {\n        var timestamp = timestamp_1.Timestamp.fromDate(val);\n        return {\n          timestampValue: {\n            seconds: timestamp.seconds,\n            nanos: timestamp.nanoseconds\n          }\n        };\n      }\n\n      if (isMomentJsType(val)) {\n        var _timestamp = timestamp_1.Timestamp.fromDate(val.toDate());\n\n        return {\n          timestampValue: {\n            seconds: _timestamp.seconds,\n            nanos: _timestamp.nanoseconds\n          }\n        };\n      }\n\n      if (val === null) {\n        return {\n          nullValue: 'NULL_VALUE'\n        };\n      }\n\n      if (val instanceof Buffer || val instanceof Uint8Array) {\n        return {\n          bytesValue: val\n        };\n      }\n\n      if (util_1.isObject(val)) {\n        var toProto = val['toProto'];\n\n        if (typeof toProto === 'function') {\n          return toProto.bind(val)();\n        }\n      }\n\n      if (Array.isArray(val)) {\n        var array = {\n          arrayValue: {}\n        };\n\n        if (val.length > 0) {\n          array.arrayValue.values = [];\n\n          for (var i = 0; i < val.length; ++i) {\n            var enc = this.encodeValue(val[i]);\n\n            if (enc) {\n              array.arrayValue.values.push(enc);\n            }\n          }\n        }\n\n        return array;\n      }\n\n      if (typeof val === 'object' && util_1.isPlainObject(val)) {\n        var map = {\n          mapValue: {}\n        }; // If we encounter an empty object, we always need to send it to make sure\n        // the server creates a map entry.\n\n        if (!util_1.isEmpty(val)) {\n          map.mapValue.fields = this.encodeFields(val);\n\n          if (util_1.isEmpty(map.mapValue.fields)) {\n            return null;\n          }\n        }\n\n        return map;\n      }\n\n      if (val === undefined && this.allowUndefined) {\n        return null;\n      }\n\n      throw new Error(\"Cannot encode value: \".concat(val));\n    }\n    /**\n     * Decodes a single Firestore 'Value' Protobuf.\n     *\n     * @private\n     * @param proto A Firestore 'Value' Protobuf.\n     * @returns The converted JS type.\n     */\n\n  }, {\n    key: \"decodeValue\",\n    value: function decodeValue(proto) {\n      var valueType = convert_1.detectValueType(proto);\n\n      switch (valueType) {\n        case 'stringValue':\n          {\n            return proto.stringValue;\n          }\n\n        case 'booleanValue':\n          {\n            return proto.booleanValue;\n          }\n\n        case 'integerValue':\n          {\n            return this.createInteger(proto.integerValue);\n          }\n\n        case 'doubleValue':\n          {\n            return proto.doubleValue;\n          }\n\n        case 'timestampValue':\n          {\n            return timestamp_1.Timestamp.fromProto(proto.timestampValue);\n          }\n\n        case 'referenceValue':\n          {\n            var resourcePath = path_1.QualifiedResourcePath.fromSlashSeparatedString(proto.referenceValue);\n            return this.createReference(resourcePath.relativeName);\n          }\n\n        case 'arrayValue':\n          {\n            var array = [];\n\n            if (Array.isArray(proto.arrayValue.values)) {\n              var _iterator = _createForOfIteratorHelper(proto.arrayValue.values),\n                  _step;\n\n              try {\n                for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                  var value = _step.value;\n                  array.push(this.decodeValue(value));\n                }\n              } catch (err) {\n                _iterator.e(err);\n              } finally {\n                _iterator.f();\n              }\n            }\n\n            return array;\n          }\n\n        case 'nullValue':\n          {\n            return null;\n          }\n\n        case 'mapValue':\n          {\n            var obj = {};\n            var fields = proto.mapValue.fields;\n\n            if (fields) {\n              for (var _i2 = 0, _Object$keys2 = Object.keys(fields); _i2 < _Object$keys2.length; _i2++) {\n                var prop = _Object$keys2[_i2];\n                obj[prop] = this.decodeValue(fields[prop]);\n              }\n            }\n\n            return obj;\n          }\n\n        case 'geoPointValue':\n          {\n            return geo_point_1.GeoPoint.fromProto(proto.geoPointValue);\n          }\n\n        case 'bytesValue':\n          {\n            return proto.bytesValue;\n          }\n\n        default:\n          {\n            throw new Error('Cannot decode type from Firestore Value: ' + JSON.stringify(proto));\n          }\n      }\n    }\n  }]);\n\n  return Serializer;\n}();\n\nexports.Serializer = Serializer;\n/**\n * Validates a JavaScript value for usage as a Firestore value.\n *\n * @private\n * @param arg The argument name or argument index (for varargs methods).\n * @param value JavaScript value to validate.\n * @param desc A description of the expected type.\n * @param path The field path to validate.\n * @param options Validation options\n * @param level The current depth of the traversal. This is used to decide\n * whether undefined values or deletes are allowed.\n * @param inArray Whether we are inside an array.\n * @throws when the object is invalid.\n */\n\nfunction validateUserInput(arg, value, desc, options, path, level, inArray) {\n  if (path && path.size > MAX_DEPTH) {\n    throw new Error(\"\".concat(validate_1.invalidArgumentMessage(arg, desc), \" Input object is deeper than \").concat(MAX_DEPTH, \" levels or contains a cycle.\"));\n  }\n\n  level = level || 0;\n  inArray = inArray || false;\n  var fieldPathMessage = path ? \" (found in field \\\"\".concat(path, \"\\\")\") : '';\n\n  if (Array.isArray(value)) {\n    for (var i = 0; i < value.length; ++i) {\n      validateUserInput(arg, value[i], desc, options, path ? path.append(String(i)) : new path_1.FieldPath(String(i)), level + 1,\n      /* inArray= */\n      true);\n    }\n  } else if (util_1.isPlainObject(value)) {\n    for (var _i3 = 0, _Object$keys3 = Object.keys(value); _i3 < _Object$keys3.length; _i3++) {\n      var prop = _Object$keys3[_i3];\n      validateUserInput(arg, value[prop], desc, options, path ? path.append(new path_1.FieldPath(prop)) : new path_1.FieldPath(prop), level + 1, inArray);\n    }\n  } else if (value === undefined) {\n    if (options.allowUndefined && level === 0) {\n      throw new Error(\"\".concat(validate_1.invalidArgumentMessage(arg, desc), \" \\\"undefined\\\" values are only ignored inside of objects.\"));\n    } else if (!options.allowUndefined) {\n      throw new Error(\"\".concat(validate_1.invalidArgumentMessage(arg, desc), \" Cannot use \\\"undefined\\\" as a Firestore value\").concat(fieldPathMessage, \". \") + 'If you want to ignore undefined values, enable `ignoreUndefinedProperties`.');\n    }\n  } else if (value instanceof field_value_1.DeleteTransform) {\n    if (inArray) {\n      throw new Error(\"\".concat(validate_1.invalidArgumentMessage(arg, desc), \" \").concat(value.methodName, \"() cannot be used inside of an array\").concat(fieldPathMessage, \".\"));\n    } else if (options.allowDeletes === 'none') {\n      throw new Error(\"\".concat(validate_1.invalidArgumentMessage(arg, desc), \" \").concat(value.methodName, \"() must appear at the top-level and can only be used in update() \") + \"or set() with {merge:true}\".concat(fieldPathMessage, \".\"));\n    } else if (options.allowDeletes === 'root') {\n      if (level === 0) {// Ok (update() with UpdateData).\n      } else if (level === 1 && (path === null || path === void 0 ? void 0 : path.size) === 1) {// Ok (update with varargs).\n      } else {\n        throw new Error(\"\".concat(validate_1.invalidArgumentMessage(arg, desc), \" \").concat(value.methodName, \"() must appear at the top-level and can only be used in update() \") + \"or set() with {merge:true}\".concat(fieldPathMessage, \".\"));\n      }\n    }\n  } else if (value instanceof field_value_1.FieldTransform) {\n    if (inArray) {\n      throw new Error(\"\".concat(validate_1.invalidArgumentMessage(arg, desc), \" \").concat(value.methodName, \"() cannot be used inside of an array\").concat(fieldPathMessage, \".\"));\n    } else if (!options.allowTransforms) {\n      throw new Error(\"\".concat(validate_1.invalidArgumentMessage(arg, desc), \" \").concat(value.methodName, \"() can only be used in set(), create() or update()\").concat(fieldPathMessage, \".\"));\n    }\n  } else if (value instanceof path_1.FieldPath) {\n    throw new Error(\"\".concat(validate_1.invalidArgumentMessage(arg, desc), \" Cannot use object of type \\\"FieldPath\\\" as a Firestore value\").concat(fieldPathMessage, \".\"));\n  } else if (value instanceof index_1.DocumentReference) {// Ok.\n  } else if (value instanceof geo_point_1.GeoPoint) {// Ok.\n  } else if (value instanceof timestamp_1.Timestamp || value instanceof Date) {// Ok.\n  } else if (isMomentJsType(value)) {// Ok.\n  } else if (value instanceof Buffer || value instanceof Uint8Array) {// Ok.\n  } else if (value === null) {// Ok.\n  } else if (typeof value === 'object') {\n    throw new Error(validate_1.customObjectMessage(arg, value, path));\n  }\n}\n\nexports.validateUserInput = validateUserInput;\n/**\n * Returns true if value is a MomentJs date object.\n * @private\n */\n\nfunction isMomentJsType(value) {\n  return typeof value === 'object' && value !== null && value.constructor && value.constructor.name === 'Moment' && typeof value.toDate === 'function';\n}","map":{"version":3,"sources":["C:/Users/Zack/Desktop/rms-home/node_modules/@google-cloud/firestore/build/src/serializer.js"],"names":["Object","defineProperty","exports","value","convert_1","require","field_value_1","geo_point_1","index_1","path_1","timestamp_1","util_1","validate_1","MAX_DEPTH","Serializer","firestore","createReference","path","doc","createInteger","n","_settings","useBigInt","BigInt","Number","allowUndefined","ignoreUndefinedProperties","obj","fields","keys","prop","val","encodeValue","FieldTransform","stringValue","booleanValue","isSafeInteger","integerValue","doubleValue","toString","Date","timestamp","Timestamp","fromDate","timestampValue","seconds","nanos","nanoseconds","isMomentJsType","toDate","nullValue","Buffer","Uint8Array","bytesValue","isObject","toProto","bind","Array","isArray","array","arrayValue","length","values","i","enc","push","isPlainObject","map","mapValue","isEmpty","encodeFields","undefined","Error","proto","valueType","detectValueType","fromProto","resourcePath","QualifiedResourcePath","fromSlashSeparatedString","referenceValue","relativeName","decodeValue","GeoPoint","geoPointValue","JSON","stringify","validateUserInput","arg","desc","options","level","inArray","size","invalidArgumentMessage","fieldPathMessage","append","String","FieldPath","DeleteTransform","methodName","allowDeletes","allowTransforms","DocumentReference","customObjectMessage","constructor","name"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AACAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;;AACA,IAAMC,SAAS,GAAGC,OAAO,CAAC,WAAD,CAAzB;;AACA,IAAMC,aAAa,GAAGD,OAAO,CAAC,eAAD,CAA7B;;AACA,IAAME,WAAW,GAAGF,OAAO,CAAC,aAAD,CAA3B;;AACA,IAAMG,OAAO,GAAGH,OAAO,CAAC,SAAD,CAAvB;;AACA,IAAMI,MAAM,GAAGJ,OAAO,CAAC,QAAD,CAAtB;;AACA,IAAMK,WAAW,GAAGL,OAAO,CAAC,aAAD,CAA3B;;AACA,IAAMM,MAAM,GAAGN,OAAO,CAAC,QAAD,CAAtB;;AACA,IAAMO,UAAU,GAAGP,OAAO,CAAC,YAAD,CAA1B;AACA;AACA;AACA;AACA;AACA;;;AACA,IAAMQ,SAAS,GAAG,EAAlB;AACA;AACA;AACA;AACA;AACA;AACA;;IACMC,U;AACF,sBAAYC,SAAZ,EAAuB;AAAA;;AACnB;AACA;AACA;AACA,SAAKC,eAAL,GAAuB,UAAAC,IAAI;AAAA,aAAIF,SAAS,CAACG,GAAV,CAAcD,IAAd,CAAJ;AAAA,KAA3B;;AACA,SAAKE,aAAL,GAAqB,UAAAC,CAAC;AAAA,aAAIL,SAAS,CAACM,SAAV,CAAoBC,SAApB,GAAgCC,MAAM,CAACH,CAAD,CAAtC,GAA4CI,MAAM,CAACJ,CAAD,CAAtD;AAAA,KAAtB;;AACA,SAAKK,cAAL,GAAsB,CAAC,CAACV,SAAS,CAACM,SAAV,CAAoBK,yBAA5C;AACH;AACD;AACJ;AACA;AACA;AACA;AACA;AACA;;;;;WACI,sBAAaC,GAAb,EAAkB;AACd,UAAMC,MAAM,GAAG,EAAf;;AACA,sCAAmB5B,MAAM,CAAC6B,IAAP,CAAYF,GAAZ,CAAnB,kCAAqC;AAAhC,YAAMG,IAAI,mBAAV;AACD,YAAMC,GAAG,GAAG,KAAKC,WAAL,CAAiBL,GAAG,CAACG,IAAD,CAApB,CAAZ;;AACA,YAAIC,GAAJ,EAAS;AACLH,UAAAA,MAAM,CAACE,IAAD,CAAN,GAAeC,GAAf;AACH;AACJ;;AACD,aAAOH,MAAP;AACH;AACD;AACJ;AACA;AACA;AACA;AACA;AACA;;;;WACI,qBAAYG,GAAZ,EAAiB;AACb,UAAIA,GAAG,YAAYzB,aAAa,CAAC2B,cAAjC,EAAiD;AAC7C,eAAO,IAAP;AACH;;AACD,UAAI,OAAOF,GAAP,KAAe,QAAnB,EAA6B;AACzB,eAAO;AACHG,UAAAA,WAAW,EAAEH;AADV,SAAP;AAGH;;AACD,UAAI,OAAOA,GAAP,KAAe,SAAnB,EAA8B;AAC1B,eAAO;AACHI,UAAAA,YAAY,EAAEJ;AADX,SAAP;AAGH;;AACD,UAAI,OAAOA,GAAP,KAAe,QAAnB,EAA6B;AACzB,YAAIP,MAAM,CAACY,aAAP,CAAqBL,GAArB,CAAJ,EAA+B;AAC3B,iBAAO;AACHM,YAAAA,YAAY,EAAEN;AADX,WAAP;AAGH,SAJD,MAKK;AACD,iBAAO;AACHO,YAAAA,WAAW,EAAEP;AADV,WAAP;AAGH;AACJ;;AACD,UAAI,OAAOA,GAAP,KAAe,QAAnB,EAA6B;AACzB,eAAO;AACHM,UAAAA,YAAY,EAAEN,GAAG,CAACQ,QAAJ;AADX,SAAP;AAGH;;AACD,UAAIR,GAAG,YAAYS,IAAnB,EAAyB;AACrB,YAAMC,SAAS,GAAG/B,WAAW,CAACgC,SAAZ,CAAsBC,QAAtB,CAA+BZ,GAA/B,CAAlB;AACA,eAAO;AACHa,UAAAA,cAAc,EAAE;AACZC,YAAAA,OAAO,EAAEJ,SAAS,CAACI,OADP;AAEZC,YAAAA,KAAK,EAAEL,SAAS,CAACM;AAFL;AADb,SAAP;AAMH;;AACD,UAAIC,cAAc,CAACjB,GAAD,CAAlB,EAAyB;AACrB,YAAMU,UAAS,GAAG/B,WAAW,CAACgC,SAAZ,CAAsBC,QAAtB,CAA+BZ,GAAG,CAACkB,MAAJ,EAA/B,CAAlB;;AACA,eAAO;AACHL,UAAAA,cAAc,EAAE;AACZC,YAAAA,OAAO,EAAEJ,UAAS,CAACI,OADP;AAEZC,YAAAA,KAAK,EAAEL,UAAS,CAACM;AAFL;AADb,SAAP;AAMH;;AACD,UAAIhB,GAAG,KAAK,IAAZ,EAAkB;AACd,eAAO;AACHmB,UAAAA,SAAS,EAAE;AADR,SAAP;AAGH;;AACD,UAAInB,GAAG,YAAYoB,MAAf,IAAyBpB,GAAG,YAAYqB,UAA5C,EAAwD;AACpD,eAAO;AACHC,UAAAA,UAAU,EAAEtB;AADT,SAAP;AAGH;;AACD,UAAIpB,MAAM,CAAC2C,QAAP,CAAgBvB,GAAhB,CAAJ,EAA0B;AACtB,YAAMwB,OAAO,GAAGxB,GAAG,CAAC,SAAD,CAAnB;;AACA,YAAI,OAAOwB,OAAP,KAAmB,UAAvB,EAAmC;AAC/B,iBAAOA,OAAO,CAACC,IAAR,CAAazB,GAAb,GAAP;AACH;AACJ;;AACD,UAAI0B,KAAK,CAACC,OAAN,CAAc3B,GAAd,CAAJ,EAAwB;AACpB,YAAM4B,KAAK,GAAG;AACVC,UAAAA,UAAU,EAAE;AADF,SAAd;;AAGA,YAAI7B,GAAG,CAAC8B,MAAJ,GAAa,CAAjB,EAAoB;AAChBF,UAAAA,KAAK,CAACC,UAAN,CAAiBE,MAAjB,GAA0B,EAA1B;;AACA,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGhC,GAAG,CAAC8B,MAAxB,EAAgC,EAAEE,CAAlC,EAAqC;AACjC,gBAAMC,GAAG,GAAG,KAAKhC,WAAL,CAAiBD,GAAG,CAACgC,CAAD,CAApB,CAAZ;;AACA,gBAAIC,GAAJ,EAAS;AACLL,cAAAA,KAAK,CAACC,UAAN,CAAiBE,MAAjB,CAAwBG,IAAxB,CAA6BD,GAA7B;AACH;AACJ;AACJ;;AACD,eAAOL,KAAP;AACH;;AACD,UAAI,OAAO5B,GAAP,KAAe,QAAf,IAA2BpB,MAAM,CAACuD,aAAP,CAAqBnC,GAArB,CAA/B,EAA0D;AACtD,YAAMoC,GAAG,GAAG;AACRC,UAAAA,QAAQ,EAAE;AADF,SAAZ,CADsD,CAItD;AACA;;AACA,YAAI,CAACzD,MAAM,CAAC0D,OAAP,CAAetC,GAAf,CAAL,EAA0B;AACtBoC,UAAAA,GAAG,CAACC,QAAJ,CAAaxC,MAAb,GAAsB,KAAK0C,YAAL,CAAkBvC,GAAlB,CAAtB;;AACA,cAAIpB,MAAM,CAAC0D,OAAP,CAAeF,GAAG,CAACC,QAAJ,CAAaxC,MAA5B,CAAJ,EAAyC;AACrC,mBAAO,IAAP;AACH;AACJ;;AACD,eAAOuC,GAAP;AACH;;AACD,UAAIpC,GAAG,KAAKwC,SAAR,IAAqB,KAAK9C,cAA9B,EAA8C;AAC1C,eAAO,IAAP;AACH;;AACD,YAAM,IAAI+C,KAAJ,gCAAkCzC,GAAlC,EAAN;AACH;AACD;AACJ;AACA;AACA;AACA;AACA;AACA;;;;WACI,qBAAY0C,KAAZ,EAAmB;AACf,UAAMC,SAAS,GAAGtE,SAAS,CAACuE,eAAV,CAA0BF,KAA1B,CAAlB;;AACA,cAAQC,SAAR;AACI,aAAK,aAAL;AAAoB;AAChB,mBAAOD,KAAK,CAACvC,WAAb;AACH;;AACD,aAAK,cAAL;AAAqB;AACjB,mBAAOuC,KAAK,CAACtC,YAAb;AACH;;AACD,aAAK,cAAL;AAAqB;AACjB,mBAAO,KAAKhB,aAAL,CAAmBsD,KAAK,CAACpC,YAAzB,CAAP;AACH;;AACD,aAAK,aAAL;AAAoB;AAChB,mBAAOoC,KAAK,CAACnC,WAAb;AACH;;AACD,aAAK,gBAAL;AAAuB;AACnB,mBAAO5B,WAAW,CAACgC,SAAZ,CAAsBkC,SAAtB,CAAgCH,KAAK,CAAC7B,cAAtC,CAAP;AACH;;AACD,aAAK,gBAAL;AAAuB;AACnB,gBAAMiC,YAAY,GAAGpE,MAAM,CAACqE,qBAAP,CAA6BC,wBAA7B,CAAsDN,KAAK,CAACO,cAA5D,CAArB;AACA,mBAAO,KAAKhE,eAAL,CAAqB6D,YAAY,CAACI,YAAlC,CAAP;AACH;;AACD,aAAK,YAAL;AAAmB;AACf,gBAAMtB,KAAK,GAAG,EAAd;;AACA,gBAAIF,KAAK,CAACC,OAAN,CAAce,KAAK,CAACb,UAAN,CAAiBE,MAA/B,CAAJ,EAA4C;AAAA,yDACpBW,KAAK,CAACb,UAAN,CAAiBE,MADG;AAAA;;AAAA;AACxC,oEAA6C;AAAA,sBAAlC3D,KAAkC;AACzCwD,kBAAAA,KAAK,CAACM,IAAN,CAAW,KAAKiB,WAAL,CAAiB/E,KAAjB,CAAX;AACH;AAHuC;AAAA;AAAA;AAAA;AAAA;AAI3C;;AACD,mBAAOwD,KAAP;AACH;;AACD,aAAK,WAAL;AAAkB;AACd,mBAAO,IAAP;AACH;;AACD,aAAK,UAAL;AAAiB;AACb,gBAAMhC,GAAG,GAAG,EAAZ;AACA,gBAAMC,MAAM,GAAG6C,KAAK,CAACL,QAAN,CAAexC,MAA9B;;AACA,gBAAIA,MAAJ,EAAY;AACR,gDAAmB5B,MAAM,CAAC6B,IAAP,CAAYD,MAAZ,CAAnB,qCAAwC;AAAnC,oBAAME,IAAI,qBAAV;AACDH,gBAAAA,GAAG,CAACG,IAAD,CAAH,GAAY,KAAKoD,WAAL,CAAiBtD,MAAM,CAACE,IAAD,CAAvB,CAAZ;AACH;AACJ;;AACD,mBAAOH,GAAP;AACH;;AACD,aAAK,eAAL;AAAsB;AAClB,mBAAOpB,WAAW,CAAC4E,QAAZ,CAAqBP,SAArB,CAA+BH,KAAK,CAACW,aAArC,CAAP;AACH;;AACD,aAAK,YAAL;AAAmB;AACf,mBAAOX,KAAK,CAACpB,UAAb;AACH;;AACD;AAAS;AACL,kBAAM,IAAImB,KAAJ,CAAU,8CAA8Ca,IAAI,CAACC,SAAL,CAAeb,KAAf,CAAxD,CAAN;AACH;AAlDL;AAoDH;;;;;;AAELvE,OAAO,CAACY,UAAR,GAAqBA,UAArB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,SAASyE,iBAAT,CAA2BC,GAA3B,EAAgCrF,KAAhC,EAAuCsF,IAAvC,EAA6CC,OAA7C,EAAsDzE,IAAtD,EAA4D0E,KAA5D,EAAmEC,OAAnE,EAA4E;AACxE,MAAI3E,IAAI,IAAIA,IAAI,CAAC4E,IAAL,GAAYhF,SAAxB,EAAmC;AAC/B,UAAM,IAAI2D,KAAJ,WAAa5D,UAAU,CAACkF,sBAAX,CAAkCN,GAAlC,EAAuCC,IAAvC,CAAb,0CAAyF5E,SAAzF,kCAAN;AACH;;AACD8E,EAAAA,KAAK,GAAGA,KAAK,IAAI,CAAjB;AACAC,EAAAA,OAAO,GAAGA,OAAO,IAAI,KAArB;AACA,MAAMG,gBAAgB,GAAG9E,IAAI,gCAAwBA,IAAxB,WAAmC,EAAhE;;AACA,MAAIwC,KAAK,CAACC,OAAN,CAAcvD,KAAd,CAAJ,EAA0B;AACtB,SAAK,IAAI4D,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG5D,KAAK,CAAC0D,MAA1B,EAAkC,EAAEE,CAApC,EAAuC;AACnCwB,MAAAA,iBAAiB,CAACC,GAAD,EAAMrF,KAAK,CAAC4D,CAAD,CAAX,EAAgB0B,IAAhB,EAAsBC,OAAtB,EAA+BzE,IAAI,GAAGA,IAAI,CAAC+E,MAAL,CAAYC,MAAM,CAAClC,CAAD,CAAlB,CAAH,GAA4B,IAAItD,MAAM,CAACyF,SAAX,CAAqBD,MAAM,CAAClC,CAAD,CAA3B,CAA/D,EAAgG4B,KAAK,GAAG,CAAxG;AACjB;AAAe,UADE,CAAjB;AAEH;AACJ,GALD,MAMK,IAAIhF,MAAM,CAACuD,aAAP,CAAqB/D,KAArB,CAAJ,EAAiC;AAClC,sCAAmBH,MAAM,CAAC6B,IAAP,CAAY1B,KAAZ,CAAnB,qCAAuC;AAAlC,UAAM2B,IAAI,qBAAV;AACDyD,MAAAA,iBAAiB,CAACC,GAAD,EAAMrF,KAAK,CAAC2B,IAAD,CAAX,EAAmB2D,IAAnB,EAAyBC,OAAzB,EAAkCzE,IAAI,GAAGA,IAAI,CAAC+E,MAAL,CAAY,IAAIvF,MAAM,CAACyF,SAAX,CAAqBpE,IAArB,CAAZ,CAAH,GAA6C,IAAIrB,MAAM,CAACyF,SAAX,CAAqBpE,IAArB,CAAnF,EAA+G6D,KAAK,GAAG,CAAvH,EAA0HC,OAA1H,CAAjB;AACH;AACJ,GAJI,MAKA,IAAIzF,KAAK,KAAKoE,SAAd,EAAyB;AAC1B,QAAImB,OAAO,CAACjE,cAAR,IAA0BkE,KAAK,KAAK,CAAxC,EAA2C;AACvC,YAAM,IAAInB,KAAJ,WAAa5D,UAAU,CAACkF,sBAAX,CAAkCN,GAAlC,EAAuCC,IAAvC,CAAb,+DAAN;AACH,KAFD,MAGK,IAAI,CAACC,OAAO,CAACjE,cAAb,EAA6B;AAC9B,YAAM,IAAI+C,KAAJ,CAAU,UAAG5D,UAAU,CAACkF,sBAAX,CAAkCN,GAAlC,EAAuCC,IAAvC,CAAH,2DAA8FM,gBAA9F,UACZ,6EADE,CAAN;AAEH;AACJ,GARI,MASA,IAAI5F,KAAK,YAAYG,aAAa,CAAC6F,eAAnC,EAAoD;AACrD,QAAIP,OAAJ,EAAa;AACT,YAAM,IAAIpB,KAAJ,WAAa5D,UAAU,CAACkF,sBAAX,CAAkCN,GAAlC,EAAuCC,IAAvC,CAAb,cAA6DtF,KAAK,CAACiG,UAAnE,iDAAoHL,gBAApH,OAAN;AACH,KAFD,MAGK,IAAIL,OAAO,CAACW,YAAR,KAAyB,MAA7B,EAAqC;AACtC,YAAM,IAAI7B,KAAJ,CAAU,UAAG5D,UAAU,CAACkF,sBAAX,CAAkCN,GAAlC,EAAuCC,IAAvC,CAAH,cAAmDtF,KAAK,CAACiG,UAAzD,6GACiBL,gBADjB,MAAV,CAAN;AAEH,KAHI,MAIA,IAAIL,OAAO,CAACW,YAAR,KAAyB,MAA7B,EAAqC;AACtC,UAAIV,KAAK,KAAK,CAAd,EAAiB,CACb;AACH,OAFD,MAGK,IAAIA,KAAK,KAAK,CAAV,IAAe,CAAC1E,IAAI,KAAK,IAAT,IAAiBA,IAAI,KAAK,KAAK,CAA/B,GAAmC,KAAK,CAAxC,GAA4CA,IAAI,CAAC4E,IAAlD,MAA4D,CAA/E,EAAkF,CACnF;AACH,OAFI,MAGA;AACD,cAAM,IAAIrB,KAAJ,CAAU,UAAG5D,UAAU,CAACkF,sBAAX,CAAkCN,GAAlC,EAAuCC,IAAvC,CAAH,cAAmDtF,KAAK,CAACiG,UAAzD,6GACiBL,gBADjB,MAAV,CAAN;AAEH;AACJ;AACJ,GApBI,MAqBA,IAAI5F,KAAK,YAAYG,aAAa,CAAC2B,cAAnC,EAAmD;AACpD,QAAI2D,OAAJ,EAAa;AACT,YAAM,IAAIpB,KAAJ,WAAa5D,UAAU,CAACkF,sBAAX,CAAkCN,GAAlC,EAAuCC,IAAvC,CAAb,cAA6DtF,KAAK,CAACiG,UAAnE,iDAAoHL,gBAApH,OAAN;AACH,KAFD,MAGK,IAAI,CAACL,OAAO,CAACY,eAAb,EAA8B;AAC/B,YAAM,IAAI9B,KAAJ,WAAa5D,UAAU,CAACkF,sBAAX,CAAkCN,GAAlC,EAAuCC,IAAvC,CAAb,cAA6DtF,KAAK,CAACiG,UAAnE,+DAAkIL,gBAAlI,OAAN;AACH;AACJ,GAPI,MAQA,IAAI5F,KAAK,YAAYM,MAAM,CAACyF,SAA5B,EAAuC;AACxC,UAAM,IAAI1B,KAAJ,WAAa5D,UAAU,CAACkF,sBAAX,CAAkCN,GAAlC,EAAuCC,IAAvC,CAAb,0EAAuHM,gBAAvH,OAAN;AACH,GAFI,MAGA,IAAI5F,KAAK,YAAYK,OAAO,CAAC+F,iBAA7B,EAAgD,CACjD;AACH,GAFI,MAGA,IAAIpG,KAAK,YAAYI,WAAW,CAAC4E,QAAjC,EAA2C,CAC5C;AACH,GAFI,MAGA,IAAIhF,KAAK,YAAYO,WAAW,CAACgC,SAA7B,IAA0CvC,KAAK,YAAYqC,IAA/D,EAAqE,CACtE;AACH,GAFI,MAGA,IAAIQ,cAAc,CAAC7C,KAAD,CAAlB,EAA2B,CAC5B;AACH,GAFI,MAGA,IAAIA,KAAK,YAAYgD,MAAjB,IAA2BhD,KAAK,YAAYiD,UAAhD,EAA4D,CAC7D;AACH,GAFI,MAGA,IAAIjD,KAAK,KAAK,IAAd,EAAoB,CACrB;AACH,GAFI,MAGA,IAAI,OAAOA,KAAP,KAAiB,QAArB,EAA+B;AAChC,UAAM,IAAIqE,KAAJ,CAAU5D,UAAU,CAAC4F,mBAAX,CAA+BhB,GAA/B,EAAoCrF,KAApC,EAA2Cc,IAA3C,CAAV,CAAN;AACH;AACJ;;AACDf,OAAO,CAACqF,iBAAR,GAA4BA,iBAA5B;AACA;AACA;AACA;AACA;;AACA,SAASvC,cAAT,CAAwB7C,KAAxB,EAA+B;AAC3B,SAAQ,OAAOA,KAAP,KAAiB,QAAjB,IACJA,KAAK,KAAK,IADN,IAEJA,KAAK,CAACsG,WAFF,IAGJtG,KAAK,CAACsG,WAAN,CAAkBC,IAAlB,KAA2B,QAHvB,IAIJ,OAAOvG,KAAK,CAAC8C,MAAb,KAAwB,UAJ5B;AAKH","sourcesContent":["\"use strict\";\n/*!\n * Copyright 2019 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst convert_1 = require(\"./convert\");\nconst field_value_1 = require(\"./field-value\");\nconst geo_point_1 = require(\"./geo-point\");\nconst index_1 = require(\"./index\");\nconst path_1 = require(\"./path\");\nconst timestamp_1 = require(\"./timestamp\");\nconst util_1 = require(\"./util\");\nconst validate_1 = require(\"./validate\");\n/**\n * The maximum depth of a Firestore object.\n *\n * @private\n */\nconst MAX_DEPTH = 20;\n/**\n * Serializer that is used to convert between JavaScript types and their\n * Firestore Protobuf representation.\n *\n * @private\n */\nclass Serializer {\n    constructor(firestore) {\n        // Instead of storing the `firestore` object, we store just a reference to\n        // its `.doc()` method. This avoid a circular reference, which breaks\n        // JSON.stringify().\n        this.createReference = path => firestore.doc(path);\n        this.createInteger = n => firestore._settings.useBigInt ? BigInt(n) : Number(n);\n        this.allowUndefined = !!firestore._settings.ignoreUndefinedProperties;\n    }\n    /**\n     * Encodes a JavaScript object into the Firestore 'Fields' representation.\n     *\n     * @private\n     * @param obj The object to encode.\n     * @returns The Firestore 'Fields' representation\n     */\n    encodeFields(obj) {\n        const fields = {};\n        for (const prop of Object.keys(obj)) {\n            const val = this.encodeValue(obj[prop]);\n            if (val) {\n                fields[prop] = val;\n            }\n        }\n        return fields;\n    }\n    /**\n     * Encodes a JavaScript value into the Firestore 'Value' representation.\n     *\n     * @private\n     * @param val The object to encode\n     * @returns The Firestore Proto or null if we are deleting a field.\n     */\n    encodeValue(val) {\n        if (val instanceof field_value_1.FieldTransform) {\n            return null;\n        }\n        if (typeof val === 'string') {\n            return {\n                stringValue: val,\n            };\n        }\n        if (typeof val === 'boolean') {\n            return {\n                booleanValue: val,\n            };\n        }\n        if (typeof val === 'number') {\n            if (Number.isSafeInteger(val)) {\n                return {\n                    integerValue: val,\n                };\n            }\n            else {\n                return {\n                    doubleValue: val,\n                };\n            }\n        }\n        if (typeof val === 'bigint') {\n            return {\n                integerValue: val.toString(),\n            };\n        }\n        if (val instanceof Date) {\n            const timestamp = timestamp_1.Timestamp.fromDate(val);\n            return {\n                timestampValue: {\n                    seconds: timestamp.seconds,\n                    nanos: timestamp.nanoseconds,\n                },\n            };\n        }\n        if (isMomentJsType(val)) {\n            const timestamp = timestamp_1.Timestamp.fromDate(val.toDate());\n            return {\n                timestampValue: {\n                    seconds: timestamp.seconds,\n                    nanos: timestamp.nanoseconds,\n                },\n            };\n        }\n        if (val === null) {\n            return {\n                nullValue: 'NULL_VALUE',\n            };\n        }\n        if (val instanceof Buffer || val instanceof Uint8Array) {\n            return {\n                bytesValue: val,\n            };\n        }\n        if (util_1.isObject(val)) {\n            const toProto = val['toProto'];\n            if (typeof toProto === 'function') {\n                return toProto.bind(val)();\n            }\n        }\n        if (Array.isArray(val)) {\n            const array = {\n                arrayValue: {},\n            };\n            if (val.length > 0) {\n                array.arrayValue.values = [];\n                for (let i = 0; i < val.length; ++i) {\n                    const enc = this.encodeValue(val[i]);\n                    if (enc) {\n                        array.arrayValue.values.push(enc);\n                    }\n                }\n            }\n            return array;\n        }\n        if (typeof val === 'object' && util_1.isPlainObject(val)) {\n            const map = {\n                mapValue: {},\n            };\n            // If we encounter an empty object, we always need to send it to make sure\n            // the server creates a map entry.\n            if (!util_1.isEmpty(val)) {\n                map.mapValue.fields = this.encodeFields(val);\n                if (util_1.isEmpty(map.mapValue.fields)) {\n                    return null;\n                }\n            }\n            return map;\n        }\n        if (val === undefined && this.allowUndefined) {\n            return null;\n        }\n        throw new Error(`Cannot encode value: ${val}`);\n    }\n    /**\n     * Decodes a single Firestore 'Value' Protobuf.\n     *\n     * @private\n     * @param proto A Firestore 'Value' Protobuf.\n     * @returns The converted JS type.\n     */\n    decodeValue(proto) {\n        const valueType = convert_1.detectValueType(proto);\n        switch (valueType) {\n            case 'stringValue': {\n                return proto.stringValue;\n            }\n            case 'booleanValue': {\n                return proto.booleanValue;\n            }\n            case 'integerValue': {\n                return this.createInteger(proto.integerValue);\n            }\n            case 'doubleValue': {\n                return proto.doubleValue;\n            }\n            case 'timestampValue': {\n                return timestamp_1.Timestamp.fromProto(proto.timestampValue);\n            }\n            case 'referenceValue': {\n                const resourcePath = path_1.QualifiedResourcePath.fromSlashSeparatedString(proto.referenceValue);\n                return this.createReference(resourcePath.relativeName);\n            }\n            case 'arrayValue': {\n                const array = [];\n                if (Array.isArray(proto.arrayValue.values)) {\n                    for (const value of proto.arrayValue.values) {\n                        array.push(this.decodeValue(value));\n                    }\n                }\n                return array;\n            }\n            case 'nullValue': {\n                return null;\n            }\n            case 'mapValue': {\n                const obj = {};\n                const fields = proto.mapValue.fields;\n                if (fields) {\n                    for (const prop of Object.keys(fields)) {\n                        obj[prop] = this.decodeValue(fields[prop]);\n                    }\n                }\n                return obj;\n            }\n            case 'geoPointValue': {\n                return geo_point_1.GeoPoint.fromProto(proto.geoPointValue);\n            }\n            case 'bytesValue': {\n                return proto.bytesValue;\n            }\n            default: {\n                throw new Error('Cannot decode type from Firestore Value: ' + JSON.stringify(proto));\n            }\n        }\n    }\n}\nexports.Serializer = Serializer;\n/**\n * Validates a JavaScript value for usage as a Firestore value.\n *\n * @private\n * @param arg The argument name or argument index (for varargs methods).\n * @param value JavaScript value to validate.\n * @param desc A description of the expected type.\n * @param path The field path to validate.\n * @param options Validation options\n * @param level The current depth of the traversal. This is used to decide\n * whether undefined values or deletes are allowed.\n * @param inArray Whether we are inside an array.\n * @throws when the object is invalid.\n */\nfunction validateUserInput(arg, value, desc, options, path, level, inArray) {\n    if (path && path.size > MAX_DEPTH) {\n        throw new Error(`${validate_1.invalidArgumentMessage(arg, desc)} Input object is deeper than ${MAX_DEPTH} levels or contains a cycle.`);\n    }\n    level = level || 0;\n    inArray = inArray || false;\n    const fieldPathMessage = path ? ` (found in field \"${path}\")` : '';\n    if (Array.isArray(value)) {\n        for (let i = 0; i < value.length; ++i) {\n            validateUserInput(arg, value[i], desc, options, path ? path.append(String(i)) : new path_1.FieldPath(String(i)), level + 1, \n            /* inArray= */ true);\n        }\n    }\n    else if (util_1.isPlainObject(value)) {\n        for (const prop of Object.keys(value)) {\n            validateUserInput(arg, value[prop], desc, options, path ? path.append(new path_1.FieldPath(prop)) : new path_1.FieldPath(prop), level + 1, inArray);\n        }\n    }\n    else if (value === undefined) {\n        if (options.allowUndefined && level === 0) {\n            throw new Error(`${validate_1.invalidArgumentMessage(arg, desc)} \"undefined\" values are only ignored inside of objects.`);\n        }\n        else if (!options.allowUndefined) {\n            throw new Error(`${validate_1.invalidArgumentMessage(arg, desc)} Cannot use \"undefined\" as a Firestore value${fieldPathMessage}. ` +\n                'If you want to ignore undefined values, enable `ignoreUndefinedProperties`.');\n        }\n    }\n    else if (value instanceof field_value_1.DeleteTransform) {\n        if (inArray) {\n            throw new Error(`${validate_1.invalidArgumentMessage(arg, desc)} ${value.methodName}() cannot be used inside of an array${fieldPathMessage}.`);\n        }\n        else if (options.allowDeletes === 'none') {\n            throw new Error(`${validate_1.invalidArgumentMessage(arg, desc)} ${value.methodName}() must appear at the top-level and can only be used in update() ` +\n                `or set() with {merge:true}${fieldPathMessage}.`);\n        }\n        else if (options.allowDeletes === 'root') {\n            if (level === 0) {\n                // Ok (update() with UpdateData).\n            }\n            else if (level === 1 && (path === null || path === void 0 ? void 0 : path.size) === 1) {\n                // Ok (update with varargs).\n            }\n            else {\n                throw new Error(`${validate_1.invalidArgumentMessage(arg, desc)} ${value.methodName}() must appear at the top-level and can only be used in update() ` +\n                    `or set() with {merge:true}${fieldPathMessage}.`);\n            }\n        }\n    }\n    else if (value instanceof field_value_1.FieldTransform) {\n        if (inArray) {\n            throw new Error(`${validate_1.invalidArgumentMessage(arg, desc)} ${value.methodName}() cannot be used inside of an array${fieldPathMessage}.`);\n        }\n        else if (!options.allowTransforms) {\n            throw new Error(`${validate_1.invalidArgumentMessage(arg, desc)} ${value.methodName}() can only be used in set(), create() or update()${fieldPathMessage}.`);\n        }\n    }\n    else if (value instanceof path_1.FieldPath) {\n        throw new Error(`${validate_1.invalidArgumentMessage(arg, desc)} Cannot use object of type \"FieldPath\" as a Firestore value${fieldPathMessage}.`);\n    }\n    else if (value instanceof index_1.DocumentReference) {\n        // Ok.\n    }\n    else if (value instanceof geo_point_1.GeoPoint) {\n        // Ok.\n    }\n    else if (value instanceof timestamp_1.Timestamp || value instanceof Date) {\n        // Ok.\n    }\n    else if (isMomentJsType(value)) {\n        // Ok.\n    }\n    else if (value instanceof Buffer || value instanceof Uint8Array) {\n        // Ok.\n    }\n    else if (value === null) {\n        // Ok.\n    }\n    else if (typeof value === 'object') {\n        throw new Error(validate_1.customObjectMessage(arg, value, path));\n    }\n}\nexports.validateUserInput = validateUserInput;\n/**\n * Returns true if value is a MomentJs date object.\n * @private\n */\nfunction isMomentJsType(value) {\n    return (typeof value === 'object' &&\n        value !== null &&\n        value.constructor &&\n        value.constructor.name === 'Moment' &&\n        typeof value.toDate === 'function');\n}\n//# sourceMappingURL=serializer.js.map"]},"metadata":{},"sourceType":"script"}